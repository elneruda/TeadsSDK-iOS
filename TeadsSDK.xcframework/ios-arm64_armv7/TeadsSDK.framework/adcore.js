!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e=e||self).AdCoreModule={})}(this,(function(e){"use strict";var t,s;function i(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}Array.prototype.first=function(){return this.isNotEmpty()?this[0]:void 0},Array.prototype.last=function(){if(!this.isEmpty())return this[this.length-1]},Array.prototype.isEmpty=function(){return this.length<=0},Array.prototype.isNotEmpty=function(){return!this.isEmpty()},Array.prototype.tail=function(){return this.slice(1)},String.random=function(e,t=!0){const s=t?"0123456789":"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";let i="";for(let t=0;t<e;t++)i+=s.charAt(Math.floor(Math.random()*s.length));return String(i)},String.prototype.isEmpty=function(){return this.length<=0},function(e){e.Get="GET",e.Post="POST",e.Put="PUT",e.Delete="DELETE",e.Head="HEAD"}(t||(t={})),function(e){let t;e.fromJSON=function(e){const t=JSON.parse(e);return{statusCode:t.statusCode,body:t.body,headers:t.headers,error:t.error}},function(e){e.Timeout="TIMEOUT"}(t=e.ErrorType||(e.ErrorType={}))}(s||(s={}));var r=i(function(e,t,s){return e(s={path:t,exports:{},require:function(e,t){return function(){throw new Error("Dynamic requires are not currently supported by @rollup/plugin-commonjs")}(null==t&&s.path)}},s.exports),s.exports}((function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var s=function(){function e(e){var t=this;t._keys=[],t._values=[],t.length=0,e&&e.forEach((function(e,s){t.set(e[0],e[1])}))}return e.prototype.fromJSON=function(t,s){var i=this,r=function(t){return null!==t&&"object"==typeof t&&s?(new e).fromJSON(t,!0):Array.isArray(t)&&s?t.map((function(e){return r(e)})):t};return Object.keys(t).forEach((function(e){t.hasOwnProperty(e)&&i.set(e,r(t[e]))})),i},e.prototype.toJSON=function(){var t={},s=this,i=function(t){return t instanceof e?t.toJSON():Array.isArray(t)?t.map((function(e){return i(e)})):t};return s.keys().forEach((function(e){t[String(e)]=i(s.get(e))})),t},e.prototype.entries=function(){var e=this;return[].slice.call(this.keys().map((function(t){return[t,e.get(t)]})))},e.prototype.keys=function(){return[].slice.call(this._keys)},e.prototype.values=function(){return[].slice.call(this._values)},e.prototype.has=function(e){return this._keys.indexOf(e)>-1},e.prototype.get=function(e){var t=this._keys.indexOf(e);return t>-1?this._values[t]:void 0},e.prototype.deepGet=function(t){if(!t||!t.length)return null;var s=function(t,i){return null==t?null:i.length?s(t instanceof e?t.get(i[0]):t[i[0]],i.slice(1)):t};return s(this.get(t[0]),t.slice(1))},e.prototype.set=function(e,t){var s=this,i=this._keys.indexOf(e);return i>-1?s._values[i]=t:(s._keys.push(e),s._values.push(t),s.length=s._values.length),this},e.prototype.sortedSet=function(e,t,s,i){var r=this,n=this._keys.length,o=s||0,a=void 0!==i?i:n-1;if(0==n)return r._keys.push(e),r._values.push(t),r;if(e==this._keys[o])return this._values.splice(o,0,t),this;if(e==this._keys[a])return this._values.splice(a,0,t),this;if(e>this._keys[a])return this._keys.splice(a+1,0,e),this._values.splice(a+1,0,t),this;if(e<this._keys[o])return this._values.splice(o,0,t),this._keys.splice(o,0,e),this;if(o>=a)return this;var l=o+Math.floor((a-o)/2);return e<this._keys[l]?this.sortedSet(e,t,o,l-1):e>this._keys[l]?this.sortedSet(e,t,l+1,a):this},e.prototype.size=function(){return this.length},e.prototype.clear=function(){var e=this;return e._keys.length=e.length=e._values.length=0,this},e.prototype.delete=function(e){var t=this,s=t._keys.indexOf(e);return s>-1&&(t._keys.splice(s,1),t._values.splice(s,1),t.length=t._keys.length,!0)},e.prototype.forEach=function(e){var t=this;this._keys.forEach((function(s,i){e(t.get(s),s,i)}))},e.prototype.map=function(e){var t=this;return this.keys().map((function(s,i){return e(t.get(s),s,i)}))},e.prototype.filter=function(e){var t=this;return t._keys.slice().forEach((function(s,i){!1===e(t.get(s),s,i)&&t.delete(s)})),this},e.prototype.clone=function(){return new e(this.entries())},e}();t.TSMap=s})));class n{constructor(e){this.userAgent=e}headerFrom(e){return e=e||new r.TSMap,this.userAgent&&e.set("User-Agent",this.userAgent),e}syncHttpCall(e,t,i="",n=new r.TSMap,o){return s.fromJSON(network.syncHttpCall(e,t,i,JSON.stringify(this.headerFrom(n).toJSON()),o))}asyncHttpCall(e,t,s="",i=new r.TSMap,n){network.asyncHttpCall(e,t,s,JSON.stringify(this.headerFrom(i).toJSON()),n)}postSync(e,s,i,r=30){return this.syncHttpCall(t.Post,e,s,i,r)}postAsync(e,s,i,r=30){this.asyncHttpCall(t.Post,e,s,i,r)}getSync(e,s,i=30){return this.syncHttpCall(t.Get,e,"",s,i)}getAsync(e,s,i=30){this.asyncHttpCall(t.Get,e,"",s,i)}}class o{verbose(e){logger.verbose(e)}debug(e){logger.debug(e)}warning(e){logger.warning(e)}error(e){logger.error(e)}fatal(e){logger.fatal(e)}}class a{name(){return application.name()}version(){return application.version()}build(){return application.build()}bundleId(){return application.bundleId()}canOpenUrl(e){return application.canOpenUrl(e)}}class l{os(){return device.os()}osVersion(){return device.osVersion()}screenWidth(){return device.screenWidth()}screenHeight(){return device.screenHeight()}brand(){return device.brand()}device(){return device.device()}country(){return device.country()}language(){return device.language()}batteryLevel(){return device.batteryLevel()}batteryPowerSaving(){return device.batteryPowerSaving()}env(){return device.env()}network(){return device.network()}family(){return device.family()}carrier(){return device.carrier()}}class c{setString(e,t){preferences.set(e,t)}setNumber(e,t){preferences.set(e,t.toString())}setBool(e,t){preferences.set(e,""+(t?"true":"false"))}getString(e){return preferences.get(e)}getNumber(e){const t=preferences.get(e);return Number(t)}getBool(e){const t=preferences.get(e);return"true"==t||"1"==t}}class d{nativeAdAvailable(e){const t=e.toExport(),s=JSON.stringify(t);delegate.nativeAdAvailable(s)}noAdAvailable(e){delegate.noAdAvailable(e)}openBrowser(e){delegate.openBrowser(e)}jsTracker(e){delegate.jsTracker(e)}onAdImpression(){delegate.onAdImpression()}onAdClicked(){delegate.onAdClicked()}static get(){if(delegate)return new d;throw"AdCoreDelegate missing"}}class h{version(){return sdk.version()}mediator(){return sdk.mediator()}isMediated(){return null!==this.mediator()}}const u=e=>e?e.split(".").map(e=>parseInt(e,10)||0):[];class g{constructor(e,t){this.device=e,this.sdk=t}userId(){return user.userId()}systemOptout(){const e=user.systemOptout();return e&&"IOS"===this.device.os().toUpperCase()&&(e=>{const t=u(e);return t.length<=0?0:t[0]})(this.device.osVersion())>=14?"00000000-0000-0000-0000-000000000000"===this.userId():e}}class p{constructor(e,t,s,i,r,n){this.id=e,this.required=t?1:0,this.title=s,this.img=i,this.video=r,this.data=n}isRequired(){return 1==this.required}static title(e,t,s){return new p(e,t,s)}static image(e,t,s){return new p(e,t,void 0,s)}static video(e,t,s){return new p(e,t,void 0,void 0,s)}static data(e,t,s){return new p(e,t,void 0,void 0,void 0,s)}}class m{constructor(e){this.len=e}}class v{constructor(e,t,s,i){this.type=e,this.wmin=t,this.hmin=s,this.mimes=i}}class f{constructor(e,t){this.type=e,this.len=t}}var S,A,b,E,P;!function(e){e[e.Icon=1]="Icon",e[e.Main=3]="Main"}(S||(S={})),function(e){e[e.Sponsored=1]="Sponsored",e[e.Desc=2]="Desc",e[e.Rating=3]="Rating",e[e.Likes=4]="Likes",e[e.Downloads=5]="Downloads",e[e.Price=6]="Price",e[e.SalePrice=7]="SalePrice",e[e.Phone=8]="Phone",e[e.Address=9]="Address",e[e.Desc2=10]="Desc2",e[e.DisplayURL=11]="DisplayURL",e[e.CTAText=12]="CTAText"}(A||(A={}));class I{constructor(e,t){this.event=e,this.methods=t}}!function(e){e[e.Url=1]="Url",e[e.Js=2]="Js"}(b||(b={})),function(e){e[e.FeedArticle=0]="FeedArticle",e[e.AdMob=-1]="AdMob",e[e.MoPub=-2]="MoPub"}(E||(E={})),function(e){e.fromJSON=function(t){switch(t){case 0:return e.FeedArticle;case-1:return e.AdMob;case-2:return e.MoPub;default:throw"Invalid AdCoreRequestTemplate: "+t}}}(E||(E={})),function(e){e[e.Impression=1]="Impression",e[e.ViewableMrc50=2]="ViewableMrc50",e[e.ViewableMrc100=3]="ViewableMrc100",e[e.ViewableVideo50=4]="ViewableVideo50"}(P||(P={})),function(e){e.description=function(t){switch(t){case e.Impression:return"impression";case e.ViewableMrc50:return"viewable-mrc50";case e.ViewableMrc100:return"viewable-mrc100";case e.ViewableVideo50:return"viewable-video50";default:return null}}}(P||(P={}));class y{constructor(e){this.url=y.cleanUnusedUrlMacro(e.url),this.fallbackUrl=e.fallback?y.cleanUnusedUrlMacro(e.fallback):void 0,this.clickTrackers=e.clicktrackers}static cleanUnusedUrlMacro(e){return e.replace(/[$]?\{(.*?)\}/g,"")}}class T{constructor(e,t){this.type=t,this.id=e.id,e.link&&(this.link=new y(e.link))}toExport(){return{id:this.id,type:this.type.toString()}}}!function(e){let t;!function(e){e.Title="title",e.Icon="icon",e.Image="img",e.Description="desc",e.Sponsored="sponso",e.CTA="cta",e.Video="video",e.Price="price",e.Rating="rating",e.AdChoices="adChoice"}(t=e.Type||(e.Type={}))}(T||(T={}));var k,R,_,N,C,O,w=T.Type;class L{constructor(e,t,s,i,r,n){this.device=e,this.sdk=t,this.user=s,this.preferences=i,this.settings=r,this.logger=n}build(e,t,s,i,r){const n={locale:this.device.language(),country:this.device.country(),windowReferrerUrl:this.settings.publisherSlotUrl&&!this.settings.publisherSlotUrl.isEmpty()?this.settings.publisherSlotUrl:"mobileappid:"+s.bundleId(),userId:this.user.userId(),network:this.device.network(),deviceType:this.device.device(),screenHeight:this.device.screenHeight(),screenWidth:this.device.screenWidth(),deviceFamily:this.device.family(),carrier:this.device.carrier(),osVersion:this.device.osVersion(),os:this.device.os(),appVersion:s.version(),appId:s.bundleId(),browser:"SDK",sdkVersion:this.sdk.version(),env:this.device.env(),gdprIab:i.evaluateGDPR(this.preferences,t.settings),usPrivacy:i.evaluateUSPrivacy(this.preferences,t.settings),tag:e,nativeAssets:this.generateAssetRequestFromTemplate(t.template,r),events:this.generateEventsRequestFromTemplate(t.template)};return null==n.usPrivacy&&delete n.usPrivacy,n}generateEventsRequestFromTemplate(e){switch(e){case E.AdMob:case E.MoPub:case E.FeedArticle:return[new I(P.Impression,[b.Js,b.Url])]}}generateAssetRequestFromTemplate(e,t){switch(e){case E.AdMob:return[this.title(t,!0),this.iconImage(t,!1),this.mainImage(t,!0),this.sponsored(t,!1),this.description(t,!1),this.cta(t,!1),this.price(t,!1),this.rating(t,!1)];case E.MoPub:return[this.title(t,!0),this.iconImage(t,!1),this.mainImage(t,!0),this.description(t,!1),this.cta(t,!1)];case E.FeedArticle:return[this.title(t,!1),this.iconImage(t,!1),this.mainImage(t,!0),this.sponsored(t,!1),this.cta(t,!1)]}}title(e,t){return p.title(e.toId(w.Title),t,new m(50))}iconImage(e,t){return p.image(e.toId(w.Icon),t,new v(S.Icon,48,48,["image/png","image/jpeg","image/jpg"]))}mainImage(e,t){return p.image(e.toId(w.Image),t,new v(S.Main,600,315,["image/png","image/jpeg","image/jpg"]))}sponsored(e,t){return p.data(e.toId(w.Sponsored),t,new f(A.Sponsored,25))}description(e,t){return p.data(e.toId(w.Description),t,new f(A.Desc,140))}cta(e,t){return p.data(e.toId(w.CTA),t,new f(A.CTAText,15))}price(e,t){return p.data(e.toId(w.Price),t,new f(A.Price,10))}rating(e,t){return p.data(e.toId(w.Rating),t,new f(A.Rating,1))}}class M{}function D(e){return Object.keys(e).map(t=>e[t]?["number","string","boolean"].indexOf(typeof e[t])>=0?encodeURIComponent(t)+"="+encodeURIComponent(e[t]):encodeURIComponent(t)+"="+JSON.stringify(e[t]):encodeURIComponent(t)+"=").join("&")}!function(e){e.noResponse="noResponse",e.networkError="networkError",e.richParsingError="richParsingError",e.notFilled="notFilled",e.timeout="timeout",e.statusCode="statusCode",e.serverError="serverError"}(k||(k={})),function(e){let t;e.AdAvailable=class extends e{constructor(e){super(),this.richAdResponse=e}},function(t){t.NoResponse=class extends e{};t.StatusCode=class extends e{};t.NetworkError=class extends e{};t.RichParsingError=class extends e{};t.NotFilled=class extends e{}}(t=e.AdNotAvailable||(e.AdNotAvailable={}))}(M||(M={})),function(e){let t,s,i;e.fromJSON=function(t){return{slider:e.Slider.fromJSON(t.slider),onlyNative:t.onlyNative,soundOver:t.soundOver,friendly:t.friendly,smartPosition:e.SmartPosition.fromJSON(t.smartPosition),launch:t.launch,soundMute:t.soundMute,secure:t.secure,soundStart:e.SoundStart.fromJSON(t.soundStart),videoPause:t.videoPause,videoStart:t.videoStart}},function(e){e.fromJSON=function(e){return null==e?{enable:!1}:{enable:e.enable}}}(t=e.Slider||(e.Slider={})),function(e){e.fromJSON=function(e){return null==e?{top:!1,corner:!1,mustBypassWhitelist:!1}:{top:e.top,corner:e.corner,mustBypassWhitelist:e.mustBypassWhitelist}}}(s=e.SmartPosition||(e.SmartPosition={})),function(e){e.fromJSON=function(e){return{type:e.type}}}(i=e.SoundStart||(e.SoundStart={}))}(R||(R={})),function(e){let t,s;e.fromJSON=function(t){return{soundButton:e.ButtonComponent.fromJSON(t.soundButton),credits:e.Component.fromJSON(t.credits),progressBar:t.progressBar,label:e.Component.fromJSON(t.label),callButton:e.ButtonComponent.fromJSON(t.callButton),brandLogo:e.Component.fromJSON(t.brandLogo)}},function(e){e.fromJSON=function(e){return{display:e.display}}}(t=e.Component||(e.Component={})),function(e){e.fromJSON=function(e){return{countdown:e.countdown,type:e.type}}}(s=e.ButtonComponent||(e.ButtonComponent={}))}(_||(_={})),function(e){let t;e.fromJSON=function(t){return{brandLogoUrl:t.brandLogoUrl,adType:t.adType,placementId:t.placementId,animation:e.Animations.fromJSON(t.brandLogoUrl),threshold:t.threshold,placementFormat:t.placementFormat}},function(e){e.fromJSON=function(e){return{expand:e.expand,collapse:e.collapse}}}(t=e.Animations||(e.Animations={}))}(N||(N={})),function(e){e.fromJSON=function(e){return{components:_.fromJSON(e.components),behaviors:R.fromJSON(e.behaviors),values:N.fromJSON(e.values)}}}(C||(C={}));class U{constructor(e){this.settings=e.settings,this.type=e.type,this.content=e.content,this.connectionId=e.connectionId,this.scenarioId=e.scenarioId,this.adSourceId=e.adSourceId,this.placementId=e.placementId,this.insertionId=e.insertionId,this.dspCampaignId=e.dspCampaignId,this.dspCreativeId=e.dspCreativeId,this.portfolioItemId=e.portfolioItemId}isNative(){return"NativeJson"==this.type}isVastURL(){return"VastUrl"==this.type}isVastXML(){return"VastXml"==this.type}static fromJSON(e){return new U({settings:C.fromJSON(e.settings),type:e.type,content:e.content,connectionId:e.connection_id,scenarioId:e.scenario_id,adSourceId:e.ad_source_id,placementId:e.placement_id,insertionId:e.insertion_id,dspCampaignId:e.dsp_campaign_id,dspCreativeId:e.dsp_creative_id,portfolioItemId:e.portfolio_item_id})}static fromJSONArray(e){return e.map(e=>U.fromJSON(e))}}class V{constructor(e,t){this.ads=e,this.wigoEnabled=t}static fromJSON(e){const t=U.fromJSONArray(e.ads),s=e.wigoEnabled;return new V(t,s)}get ad(){return this.ads.first()}}class F{constructor(e,t){this.network=e,this.logger=t}load(e){const t=this.createUrl(e),s=this.createBodyRequest(e);this.logger.debug("Post the AdRequest");const i=this.network.postSync(t,s);return this.generateAdResponse(i)}generateAdResponse(e){return this.logger.debug("generateAdResponse"),200===e.statusCode&&e.body?this.handleAdResponseSuccess(e):this.handleAdResponseFailure(e)}handleAdResponseSuccess(e){let t;try{this.logger.debug("handleAdResponseSuccess: "+e.body),t=JSON.parse(e.body);const s=V.fromJSON(t);return s.ad?(this.logger.debug("AdAvailable"),new M.AdAvailable(s)):new M.AdNotAvailable.NotFilled}catch(e){return this.logger.debug("handleAdResponseSuccess error: "+e),new M.AdNotAvailable.RichParsingError}}handleAdResponseFailure(e){switch(e.error){case s.ErrorType.Timeout:return new M.AdNotAvailable.NoResponse;default:return e.statusCode&&200!=e.statusCode?new M.AdNotAvailable.StatusCode:new M.AdNotAvailable.NetworkError}}createUrl(e){return`https://r.teads.tv/rich/${e.tag}?responseSerialization=v2`}createBodyRequest(e){return D(e)}}!function(e){e.CONTENTPLAYHEAD="[CONTENTPLAYHEAD]",e.CACHEBUSTING="[CACHEBUSTING]",e.ERRORCODE="[ERRORCODE]",e.ASSETURI="[ASSETURI]",e.MEDIAFILETYPE="[MEDIAFILETYPE]",e.VIEWABILITY="[VIEWABILITY]",e.DEVICEID="[DEVICEID]",e.BUNDLEID="[BUNDLEID]",e.LIMIT_TRACKING="[LIMIT_TRACKING]",e.PAGEID="[pageId]",e.PID="[pid]",e.SLOT_TYPE="[slotType]",e.ENV="[env]",e.PFID="[pfid]",e.IMPRESSIONID="[impressionId]",e.HEADER_BIDDING_PROVIDER="[headerBiddingProvider]",e.GDPR_STATUS="[gdpr_status]",e.GDPR_CONSENT="[gdpr_consent]",e.GDPR_REASON="[gdpr_reason]",e.USERID="[userId]",e.OS="[os]",e.GID="[insertionId]",e.SID="[connectionId]"}(O||(O={}));class x{constructor(e,t,s,i,r,n,o,a,l,c,d,h,u){this.pid=e,this.request=t,this.network=s,this.logger=i,this.user=r,this.device=n,this.application=o,this.delegate=a,this.preferences=l,this.privacyManager=c,this.sumologManager=d,this.formatVersion=h,this.sdkVersion=u.version()}get vid(){return this.user.userId()}url(e){var t,s;return"https://t.teads.tv/track?"+D({action:e,ts:""+Date.now(),pageId:"0",pid:""+this.pid,env:this.device.env(),pfid:"[pfid]",f:"1",vid:this.vid,referer:null===(s=null===(t=this.request)||void 0===t?void 0:t.settings)||void 0===s?void 0:s.publisherSlotUrl})}fillMacro(e){return Object.values(O).forEach(t=>{e=this.replaceMacro(t,e)}),e}replaceMacro(e,t){var s,i,r,n,o,a,l,c;const d=new RegExp(e.replace("[","\\[").replace("]","\\]"),"gi");if(!1===d.test(t))return t;let h="";const u=this.privacyManager.evaluateGDPR(this.preferences,this.request.settings);switch(e){case O.CONTENTPLAYHEAD:case O.HEADER_BIDDING_PROVIDER:case O.ERRORCODE:case O.ASSETURI:case O.MEDIAFILETYPE:h=e;break;case O.SLOT_TYPE:h="native";break;case O.CACHEBUSTING:h=String.random(8);break;case O.VIEWABILITY:h=""+(null===(i=null===(s=this.visibilityManager)||void 0===s?void 0:s.timeline)||void 0===i?void 0:i.lastVisibilityPercentage);break;case O.DEVICEID:h=this.device.device();break;case O.BUNDLEID:h=this.application.bundleId();break;case O.LIMIT_TRACKING:h=this.user.systemOptout()?"1":"0";break;case O.PAGEID:h="0";break;case O.PID:h=""+this.pid;break;case O.ENV:h=this.device.env();break;case O.PFID:h=""+(null===(n=null===(r=this.richAdResponse)||void 0===r?void 0:r.ad)||void 0===n?void 0:n.portfolioItemId);break;case O.IMPRESSIONID:h=""+Date.now();break;case O.GDPR_STATUS:h=""+u.status;break;case O.GDPR_CONSENT:h=""+u.consent;break;case O.GDPR_REASON:h=""+u.reason;break;case O.USERID:h=this.user.userId();break;case O.OS:h=this.device.os();break;case O.GID:h=""+(null===(a=null===(o=this.richAdResponse)||void 0===o?void 0:o.ad)||void 0===a?void 0:a.insertionId);break;case O.SID:h=""+(null===(c=null===(l=this.richAdResponse)||void 0===l?void 0:l.ad)||void 0===c?void 0:c.connectionId)}return h&&!h.isEmpty()?(this.logger.debug(`Macro ${e}, will be changed with ${h}`),t.replace(d,h)):t}track(e){e?(e=this.fillMacro(e),e=this.addVersionInfo(e,this.sdkVersion,this.formatVersion),this.network.getAsync(e)):(this.sumologManager.sendErrorIfNeeded("track","Can't track undefined url"),this.logger.error("Can't track undefined url"))}addVersionInfo(e,t,s){return`${e}&${D({sv:t,fv:s})}`}jsTrack(e){this.logger.debug("t:JS: "+e),this.delegate.jsTracker(e)}placementCall(){const e=this.url("placementCall");this.track(e),this.logger.debug("t:placementCall")}adNotAvailableNetworkError(){const e=this.url("adNotAvailable-networkError");this.track(e),this.logger.debug("t:adNotAvailable-networkError")}adNotAvailableNetworkTimeout(){const e=this.url("adNotAvailable-networkTimeout");this.track(e),this.logger.debug("t:adNotAvailable-networkTimeout")}adNotAvailableServerError(){const e=this.url("adNotAvailable-serverError");this.track(e),this.logger.debug("t:adNotAvailable-serverError")}adNotAvailableNotFilled(){const e=this.url("adNotAvailable-notFilled");this.track(e),this.logger.debug("t:adNotAvailable-notFilled")}adAvailableSuccess(){const e=this.url("adAvailable-success");this.track(e),this.logger.debug("t:adAvailable-success")}adAvailableErrorParseContent(){const e=this.url("adAvailable-error-parseContent");this.track(e),this.logger.debug("t:adAvailable-error-parseContent")}adReached(){const e=this.url("adReached");this.track(e),this.logger.debug("t:adReached")}nativeEventTracking(e,t=[]){var s;if(null==this.richAdResponse)throw"Illegal tracking with adResponse not defined";if(!(null===(s=this.richAdResponse.ad)||void 0===s?void 0:s.isNative())||null==this.nativeAd)return;const i=this.nativeAd.eventTrackers.filter(t=>t.event==e);i.filter(e=>e.method==b.Url).forEach(e=>this.track(e.url)),i.filter(e=>e.method==b.Js).filter(e=>e.url).map(e=>`<script src="${e.url}"><\/script>`).concat(t).reverse().filter(e=>e&&e.length>0).forEach(e=>this.jsTrack(e)),this.logger.debug("t:"+P.description(e))}impression(){var e;this.nativeEventTracking(P.Impression,(null===(e=this.nativeAd)||void 0===e?void 0:e.jsTracker)?[this.nativeAd.jsTracker]:[])}viewableMrc50(){this.nativeEventTracking(P.ViewableMrc50)}viewableMrc100(){this.nativeEventTracking(P.ViewableMrc100)}click(e){this.track(e),this.logger.debug("t:click")}visible(e){}}class B{constructor(e,t,s){this.logger=e,this.onTimelineChange=t,this.onProgressChange=s,this.maxPercentage=0,this.lastVisibilityTimestamp=0,this.lastVisibilityPercentage=0,this.mrc50Reached=!1,this.mrc100Reached=!1,this.mrc50FirstVisibilityTimestamp=0,this.mrc100FirstVisibilityTimestamp=0,this.progressFirstVisibilityTimestamp=0,this.lastProgressReached=0,this.onTimelineChange=t,this.onProgressChange=s}put(e,t){this.lastVisibilityPercentage!=t&&this.logger.debug(`v:ad ${t}%`),this.lastVisibilityTimestamp=e,this.lastVisibilityPercentage=t,this.mrc50Check(),this.mrc100Check(),this.progressCheck(),this.maxPercentage=Math.max(this.maxPercentage,this.lastVisibilityPercentage),this.onTimelineChange()}mrc50Check(){this.mrc50Reached||(this.lastVisibilityPercentage>=50?(0===this.mrc50FirstVisibilityTimestamp&&(this.mrc50FirstVisibilityTimestamp=this.lastVisibilityTimestamp),this.lastVisibilityTimestamp-this.mrc50FirstVisibilityTimestamp>=1e3&&(this.mrc50Reached=!0)):this.mrc50FirstVisibilityTimestamp=0)}mrc100Check(){this.mrc100Reached||(this.lastVisibilityPercentage>=99?(0===this.mrc100FirstVisibilityTimestamp&&(this.mrc100FirstVisibilityTimestamp=this.lastVisibilityTimestamp),this.lastVisibilityTimestamp-this.mrc100FirstVisibilityTimestamp>=1e3&&(this.mrc100Reached=!0)):this.mrc100FirstVisibilityTimestamp=0)}progressCheck(){if(!(this.lastProgressReached>9))if(this.lastVisibilityPercentage>0){0===this.progressFirstVisibilityTimestamp&&(this.progressFirstVisibilityTimestamp=this.lastVisibilityTimestamp);const e=Math.floor((this.lastVisibilityTimestamp-this.progressFirstVisibilityTimestamp)/1e3);e>0&&e<=9&&this.lastProgressReached!==e&&(this.lastProgressReached=e,this.onProgressChange(e))}else this.progressFirstVisibilityTimestamp=0}}var G,J,j,H,q;!function(e){e.placementCall="f11",e.adReceived="f30",e.adNotAvailable="f31",e.adAvailableError="f32",e.adAvailableErrorParseFail="f32-1",e.adAvailableSuccess="f33",e.errorBeforeAdReached="f42",e.adReached="f43",e.impression="f44",e.mrc50="f60",e.mrc100="f61",e.mrcVideo50="f62",e.visibileSeconds="f63",e.click="f64"}(G||(G={}));class ${constructor(e,t,s,i,r,n,o,a,l=!1){this.network=o,this.logger=a,this.testEnv=l,this.errorSampling=.4,this.performanceSampling=.1,this.kpiSampling=.1,this.sumoCollectorUrl="https://l.teads.tv/inapp/adcore-source",this.sessionQueryParam=this.createSessionQueryParams(r,t,s,e,i,n),this.shouldSendErrorLogs=this.canSendLog(this.errorSampling),this.shouldSendPerformanceLogs=this.canSendLog(this.performanceSampling),this.shouldSendKpiLogs=this.canSendLog(this.kpiSampling)}canSendLog(e){const t=Math.random()<=e;return this.logger.debug(t?"SumoManager will send logs":"SumoManager won't send logs"),t}createSessionQueryParams(e,t,s,i,r,n){return`pid=${e}&app=${t.name()}&bundle=${t.bundleId()}&appv=${t.version()}&adcV=${n}&sdk=${s.version()}&osv=${i.osVersion()}&os=${i.os()}&opt=${r.systemOptout()}&med=${s.mediator()}`}sendErrorIfNeeded(e,t){if(this.shouldSendErrorLogs){const s=this.createError(e,t,this.errorSampling);this.sendSumoLog(s)}}sendPerformanceLogIfNeeded(e,t){if(this.shouldSendPerformanceLogs){const s=this.createPerformanceLog(e,t,this.performanceSampling);this.sendSumoLog(s)}}sendKPILogIfNeeded(e){if(this.shouldSendKpiLogs){const t=this.createKPILog(e,this.kpiSampling);this.sendSumoLog(t)}}sendSumoLog(e){this.testEnv||this.network.postAsync(this.sumoCollectorUrl,this.appendSumoLogToSession(e))}appendSumoLogToSession(e){return this.sessionQueryParam+"&"+e}createKPILog(e,t){return`event=${e}&samp=${t}`}createError(e,t,s){return`method=${e}&info=${t}&event=error&samp=${s}`}createPerformanceLog(e,t,s){return`event=${e}&tm=${t}&samp=${s}`}}class Y{constructor(e,t,s,i){this.sumoLogger=i,this.impressionReached=!1,this.adReached=!1,this.viewableMrc50Reached=!1,this.viewableMrc100Reached=!1,this.progressSent=new Set,this.trackingEngine=e,this.delegate=t,this.logger=s,this.timeline=new B(this.logger,()=>this.onTimelineChange(),e=>this.onProgressChange(e)),this.assetTimeline=new Map,this.trackingEngine.visibilityManager=this}onTimelineChange(){this.checkForAdReach(),this.checkForImpression(),this.checkForViewableMrc50(),this.checkForViewableMrc100()}onProgressChange(e){this.progressSent.has(e)||(this.progressSent.add(e),this.trackingEngine.visible(e),this.sumoLogger.sendKPILogIfNeeded(G.visibileSeconds+"-"+e))}checkForAdReach(){this.adReached||this.timeline.maxPercentage>0&&(this.adReached=!0,this.trackingEngine.adReached(),this.sumoLogger.sendKPILogIfNeeded(G.adReached))}checkForImpression(){this.impressionReached||this.timeline.maxPercentage>50&&(this.impressionReached=!0,this.delegate.onAdImpression(),this.trackingEngine.impression(),this.sumoLogger.sendKPILogIfNeeded(G.impression))}checkForViewableMrc50(){this.viewableMrc50Reached||this.timeline.mrc50Reached&&(this.viewableMrc50Reached=!0,this.trackingEngine.viewableMrc50(),this.sumoLogger.sendKPILogIfNeeded(G.mrc50))}checkForViewableMrc100(){this.viewableMrc100Reached||this.timeline.mrc100Reached&&(this.viewableMrc100Reached=!0,this.trackingEngine.viewableMrc100(),this.sumoLogger.sendKPILogIfNeeded(G.mrc100))}visibilityChange(e){this.timeline.put(Date.now(),e)}assetVisibilityChange(e,t){}}function K({gdprStatus:e,gdprConsent:t,gdprApiVersion:s,gdprCmpId:i}){const r={apiVersion:null,cmpId:i||null};if(null!=e&&t){if(e){return(t&&t.length>0?t:null)&&(r.apiVersion=s||H.V1),Object.assign({status:J.GDPR_APPLIES_PUBLISHER,consent:t&&t.length>0?t:null,reason:j.GDPR_APPLIES_PUBLISHER_CLASSIC},r)}return Object.assign({status:J.GDPR_DOESNT_APPLY,consent:null,reason:j.GDPR_DOESNT_APPLY},r)}return Object.assign({status:J.UNSUCCESSFUL_CMP_RESPONSE,consent:null,reason:j.UNSUCCESSFUL_CMP_RESPONSE},r)}!function(e){e[e.GDPR_DOESNT_APPLY=0]="GDPR_DOESNT_APPLY",e[e.GDPR_APPLIES_GLOBAL=11]="GDPR_APPLIES_GLOBAL",e[e.GDPR_APPLIES_PUBLISHER=12]="GDPR_APPLIES_PUBLISHER",e[e.UNSUCCESSFUL_CMP_RESPONSE=21]="UNSUCCESSFUL_CMP_RESPONSE",e[e.CMP_NOT_FOUND=22]="CMP_NOT_FOUND",e[e.CMP_NOT_READY=23]="CMP_NOT_READY",e[e.OTHER=24]="OTHER"}(J||(J={})),function(e){e[e.GDPR_DOESNT_APPLY=0]="GDPR_DOESNT_APPLY",e[e.GDPR_APPLIES_GLOBAL_CLASSIC=110]="GDPR_APPLIES_GLOBAL_CLASSIC",e[e.GDPR_APPLIES_GLOBAL_OVERLAY=111]="GDPR_APPLIES_GLOBAL_OVERLAY",e[e.GDPR_APPLIES_GLOBAL_TEADS_BECAUSE_NO_CMP=112]="GDPR_APPLIES_GLOBAL_TEADS_BECAUSE_NO_CMP",e[e.GDPR_APPLIES_GLOBAL_TEADS_AFTER_TIMEOUT=113]="GDPR_APPLIES_GLOBAL_TEADS_AFTER_TIMEOUT",e[e.GDPR_APPLIES_GLOBAL_TEADS_AFTER_CMP_ERROR=114]="GDPR_APPLIES_GLOBAL_TEADS_AFTER_CMP_ERROR",e[e.GDPR_APPLIES_PUBLISHER_CLASSIC=120]="GDPR_APPLIES_PUBLISHER_CLASSIC",e[e.GDPR_APPLIES_PUBLISHER_OVERLAY=121]="GDPR_APPLIES_PUBLISHER_OVERLAY",e[e.GDPR_APPLIES_PUBLISHER_TEADS_BECAUSE_NO_CMP=122]="GDPR_APPLIES_PUBLISHER_TEADS_BECAUSE_NO_CMP",e[e.GDPR_APPLIES_PUBLISHER_TEADS_AFTER_TIMEOUT=123]="GDPR_APPLIES_PUBLISHER_TEADS_AFTER_TIMEOUT",e[e.GDPR_APPLIES_PUBLISHER_TEADS_AFTER_CMP_ERROR=124]="GDPR_APPLIES_PUBLISHER_TEADS_AFTER_CMP_ERROR",e[e.UNSUCCESSFUL_CMP_RESPONSE=210]="UNSUCCESSFUL_CMP_RESPONSE",e[e.CMP_ERROR=211]="CMP_ERROR",e[e.CMP_NOT_FOUND=220]="CMP_NOT_FOUND",e[e.CMP_NOT_READY_NO_RESPONSE=230]="CMP_NOT_READY_NO_RESPONSE",e[e.CMP_NOT_READY_JS_NOT_LOADED=231]="CMP_NOT_READY_JS_NOT_LOADED",e[e.CMP_NOT_READY_NO_PING_RESPONSE=232]="CMP_NOT_READY_NO_PING_RESPONSE",e[e.OTHER=240]="OTHER"}(j||(j={})),function(e){e[e.V1=1]="V1",e[e.V2=2]="V2"}(H||(H={})),function(e){e.getVendorConsents="getVendorConsents",e.getConsentData="getConsentData",e.ping="ping",e.getPublisherConsents="getPublisherConsents",e.getVendorList="getVendorList"}(q||(q={}));class W{evaluateGDPR(e,t){const s=e.getBool("IABConsent_SubjectToGDPR"),i=e.getString("IABConsent_ConsentString"),r=e.getNumber("IABTCF_gdprApplies"),n=e.getString("IABTCF_TCString"),o=e.getNumber("IABTCF_PolicyVersion"),a=e.getNumber("IABTCF_CmpSdkID");if((null==t?void 0:t.consent)&&(null==t?void 0:t.subjectToGDPR)){return K({gdprStatus:"1"===(null==t?void 0:t.subjectToGDPR),gdprConsent:null==t?void 0:t.consent,gdprApiVersion:null==t?void 0:t.tcfVersion,gdprCmpId:null==t?void 0:t.cmpSdkID})}if(r&&n&&o&&a){return K({gdprStatus:1===r,gdprConsent:n,gdprApiVersion:2===o?H.V2:H.V1,gdprCmpId:a})}return K({gdprStatus:s,gdprConsent:i,gdprApiVersion:H.V1})}evaluateUSPrivacy(e,t){const s=e.getString("IABUSPrivacy_String");return(null==t?void 0:t.usPrivacy)||s?(null==t?void 0:t.usPrivacy)||s:null}}class Q extends T{constructor(e){super(e,T.Type.AdChoices),this.fallbackUrl="https://privacy-policy.teads.tv?utm_source=inread&utm_medium=icon&utm_campaign=adchoices"}toExport(){return Object.assign(Object.assign({},super.toExport()),{fallbackUrl:this.fallbackUrl})}}class X{constructor(e,t,s,i,r,n){this.nativeAd=e,this.trackingEngine=t,this.logger=s,this.delegate=i,this.application=r,this.sumoLogger=n}click(){this.handleClick(this.nativeAd.link)}assetClick(e){const t=this.nativeAd.assetWithId(e);t?(this.logger.debug("click on asset "+e),this.handleClick(t.link,e)):this.logger.warning("Asset click on unknown asset with id "+e)}handleClick(e,t){this.sumoLogger.sendKPILogIfNeeded(G.click),e?this.handleClickIfPossible(e,t):this.handleClickIfPossible(this.nativeAd.link,t)}handleClickIfPossible(e,t){if(e)if(e.clickTrackers&&e.clickTrackers.forEach(e=>{this.trackingEngine.click(e)}),(!t||t&&100!=t)&&this.delegate.onAdClicked(),e.url&&this.application.canOpenUrl(e.url))this.logger.debug("Open Browser on url "+e.url),this.delegate.openBrowser(e.url);else if(e.fallbackUrl&&this.application.canOpenUrl(e.fallbackUrl)){if(this.logger.debug(`Click using fallback url (original is ${e.url})`),this.delegate.openBrowser(e.fallbackUrl),e.url){const t=`Can't open original url (${e.url})`;this.sumoLogger.sendErrorIfNeeded("handleClickIfPossible",t),this.logger.error(t)}}else{const t=`Can't open fallbackUrl url (${e.fallbackUrl})`;this.sumoLogger.sendErrorIfNeeded("handleClickIfPossible",t),this.logger.error(t)}}}var z;!function(e){e.timeToInit="tm0",e.timeToLoad="tm1"}(z||(z={}));class Z{constructor(e,t){this.sumologManager=e,this.initTS=t}finishInit(){this.finishInitTS=Date.now(),this.sumologManager.sendPerformanceLogIfNeeded(z.timeToInit,this.calculateTimeDifferenceInMS(this.initTS,this.finishInitTS))}loadStarted(){this.loadStartedTS=Date.now()}loadFinished(){if(null==this.loadStartedTS)throw"Illegal state, cannot call loadFinish if not started before";this.loadFinishedTS=Date.now(),this.sumologManager.sendPerformanceLogIfNeeded(z.timeToLoad,this.calculateTimeDifferenceInMS(this.loadStartedTS,this.loadFinishedTS))}calculateTimeDifferenceInMS(e,t){return Math.abs(e-t)}}var ee,te,se;!function(e){e[e.SLOW=1]="SLOW",e[e.NORMAL=2]="NORMAL",e[e.FAST=3]="FAST"}(ee||(ee={})),function(e){e.fromJSON=function(e){return{debugModeEnabled:e.debugModeEnabled,locationEnabled:e.locationEnabled,lightEndScreenEnabled:e.lightEndScreenEnabled,mediaPreloadEnabled:e.mediaPreloadEnabled,publisherSlotUrl:e.publisherSlotUrl,consent:e.consent,subjectToGDPR:e.subjectToGDPR,tcfVersion:2===e.tcfVersion?H.V2:H.V1,cmpSdkID:e.cmpSdkID,validationModeEnabled:e.validationModeEnabled,usPrivacy:e.usPrivacy,extras:(new r.TSMap).fromJSON(e.extras||{}),crashReporterEnabled:e.crashReporterEnabled,audioSessionIsApplicationManaged:e.audioSessionIsApplicationManaged,batteryMonitoringEnabled:e.batteryMonitoringEnabled,browserUrlHidden:e.browserUrlHidden,browserToolbarBackgroundColor:e.browserToolbarBackgroundColor,visibilityCheckSpeed:e.visibilityCheckSpeed}}}(te||(te={})),function(e){e.fromJSON=function(e){return{settings:te.fromJSON(e.settings),template:E.fromJSON(e.template)}}}(se||(se={}));const ie=new class{constructor(e){this.assetTypeToId=new Map,this.idToAssetType=new Map;for(const[t,s]of e){if(this.assetTypeToId.has(s))throw"Illegal mapping: duplicate assetType "+s;if(this.idToAssetType.has(t))throw"Illegal mapping: duplicate id "+t;this.assetTypeToId.set(s,t),this.idToAssetType.set(t,s)}}toId(e){const t=this.assetTypeToId.get(e);if(null==t)throw"Broken mapping for asset type: "+e;return t}toAssetType(e){return this.idToAssetType.get(e)||null}}([[0,T.Type.Title],[1,T.Type.Icon],[2,T.Type.Image],[3,T.Type.Sponsored],[4,T.Type.Description],[5,T.Type.CTA],[6,T.Type.Video],[7,T.Type.Price],[8,T.Type.Rating],[100,T.Type.AdChoices]]);class re{constructor(e,t,s){this.event=e,this.method=t,this.url=s}static fromJSON(e){return new re(e.event,e.method,e.url)}}class ne extends T{constructor(e){super(e,T.Type.CTA);const t=e.data||{};this.text=t.value}toExport(){return Object.assign(Object.assign({},super.toExport()),{text:this.text})}}class oe extends T{constructor(e){super(e,T.Type.Title);const t=e.title||{};this.text=t.text}toExport(){return Object.assign(Object.assign({},super.toExport()),{text:this.text})}}class ae extends T{constructor(e){super(e,T.Type.Image);const t=e.img||{};this.url=t.url,this.width=t.width,this.height=t.height}toExport(){return Object.assign(Object.assign({},super.toExport()),{url:this.url})}}class le extends T{constructor(e){super(e,T.Type.Description);const t=e.data||{};this.text=t.value}toExport(){return Object.assign(Object.assign({},super.toExport()),{text:this.text})}}class ce extends T{constructor(e){super(e,T.Type.Icon);const t=e.img||{};this.url=t.url,this.width=t.width,this.height=t.height}toExport(){return Object.assign(Object.assign({},super.toExport()),{url:this.url})}}class de extends T{constructor(e){super(e,T.Type.Sponsored);const t=e.data||{};this.text=t.value}toExport(){return Object.assign(Object.assign({},super.toExport()),{text:this.text})}}class he extends T{constructor(e){super(e,T.Type.Rating);const t=e.data||{};this.text=t.value}toExport(){return Object.assign(Object.assign({},super.toExport()),{text:this.text})}}class ue extends T{constructor(e){super(e,T.Type.Price);const t=e.data||{};this.text=t.value}toExport(){return Object.assign(Object.assign({},super.toExport()),{text:this.text})}}class ge{constructor({version:e,link:t,eventTrackers:s,jsTracker:i,assets:r,assetsUrl:n}){this.version=e,this.link=t,this.eventTrackers=s,this.jsTracker=i,this.assets=r,this.assetsUrl=n}assetWithId(e){return this.assets.find(t=>t.id==e)}static fromJSON(e,t){if(!e.native)throw"Ad response doesnt contain native";const s=e.native,i=(s.eventtrackers||[]).map(e=>re.fromJSON(e)),r=new y(s.link),n=ge.parseAssets(s,t)||[],o=s.assetsurl;return new ge({version:s.ver,link:r,jsTracker:s.jstracker,eventTrackers:i,assets:n,assetsUrl:o})}adChoicesAsset(){return this.assets.filter((e,t,s)=>100==e.id).first()}validateAssets(e){const t=this.assets.map(e=>e.id);return e.every(e=>t.includes(e))}static parseAssets(e,t){var s;return null===(s=e.assets)||void 0===s?void 0:s.map(e=>{const s=e.id;if(null==s)return null;switch(t.toAssetType(s)){case T.Type.CTA:return new ne(e);case T.Type.Icon:return new ce(e);case T.Type.Description:return new le(e);case T.Type.Image:return new ae(e);case T.Type.Sponsored:return new de(e);case T.Type.Title:return new oe(e);case T.Type.Price:return new ue(e);case T.Type.Rating:return new he(e);case T.Type.AdChoices:return new Q(e);case T.Type.Video:default:return null}})}toExport(){return this.assets.map(e=>e.toExport())}}class pe{constructor({link:e,eventTrackers:t,assets:s}){this.link=e,this.eventTrackers=t,this.assets=s}static fromJSON(e,t){const s=ge.parseAssets(e,t),i=(e.eventtrackers||[]).map(e=>re.fromJSON(e));return new pe({link:new y(e.link),eventTrackers:i,assets:s})}}class me{constructor(e,t,s){this.network=e,this.logger=t,this.assetTypeMapping=s}load(e){const t=this.network.getSync(e);return this.generateAssetsUrlResponse(t)}generateAssetsUrlResponse(e){if(200===e.statusCode&&e.body)return this.handleAssetsUrlResponseSuccess(e)}handleAssetsUrlResponseSuccess(e){try{const t=JSON.parse(e.body),s=pe.fromJSON(t,this.assetTypeMapping);return this.logger.debug("AssetsUrlContent available"),s}catch(e){return void this.logger.warning("Unable to parse assetsUrl response")}}}class ve{constructor(e,t){this.network=e,this.logger=t}handleNativeAdParsing(e,t){const s=ge.fromJSON(e,ie),i=this.fetchAssetsUrl(ie,s.assetsUrl),r=ve.merge(s,i);if(!r.validateAssets(t))throw`NativeAd doesnt contain requested required assets (${t.join(",")})`;return r}fetchAssetsUrl(e,t){if(null!=t){return new me(this.network,this.logger,e).load(t)}}static merge(e,t){if(null!=t){const s=t.assets,i=e.adChoicesAsset();null!=i&&s.push(i);const r=e.eventTrackers.concat(t.eventTrackers),n=e.link.clickTrackers.concat(t.link.clickTrackers),o=new y({url:t.link.url,fallback:t.link.fallbackUrl,clicktrackers:n});return new ge({version:e.version,link:o,jsTracker:e.jsTracker,eventTrackers:r,assets:s,assetsUrl:e.assetsUrl})}return e}}class fe{constructor(e,t,s,i){this.logger=s,this.application=new a,this.device=new l,this.network=new n(function(e,t){if("Apple"==e.brand()){const s="tablet"==e.family()?"iPad":"iPhone",i=e.osVersion().split(".").join("_");return`${t.name()}/${t.version()} (${s}; CPU iPhone OS ${i} like Mac OS X) AppleWebKit (KHTML, like Gecko) Mobile`}}(this.device,this.application)),this.logger=s,this.delegate=d.get(),this.preferences=new c,this.sdk=new h,this.user=new g(this.device,this.sdk),this.privacyManager=new W,this.pid=e;let r="adc-54";"".isEmpty()||(r+="-"),this.sumoLogManager=new $(this.device,this.application,this.sdk,this.user,this.pid,r,this.network,s),this.performanceManager=new Z(this.sumoLogManager,i),this.logger.debug("Create AdCore with PID "+this.pid),this.adCoreRequest=t,this.logger.debug("Native template requested : "+this.adCoreRequest.template),this.logger.debug("Create Tracking Engine"),this.trackingEngine=new x(this.pid,this.adCoreRequest,this.network,this.logger,this.user,this.device,this.application,this.delegate,this.preferences,this.privacyManager,this.sumoLogManager,r,this.sdk),this.logger.debug("Create AdRequestBuilder"),this.adRequestBuilder=new L(this.device,this.sdk,this.user,this.preferences,this.adCoreRequest.settings,this.logger),this.logger.debug("Create AdRequestLoader"),this.adRequestLoader=new F(this.network,this.logger),this.logger.debug("Create VisibilityManager"),this.visibilityManager=new Y(this.trackingEngine,this.delegate,this.logger,this.sumoLogManager),this.performanceManager.finishInit()}static adCoreRequestFromJson(e,t){try{const s=JSON.parse(e);return t.debug(""+JSON.stringify(s)),se.fromJSON(s)}catch(e){if(e instanceof SyntaxError)throw"Ad request malformed and unrecoverable";throw e}}static loadFromRequest(e,t){const s=new o;try{const i=Date.now(),r=fe.adCoreRequestFromJson(t,s),n=new fe(e,r,s,i);return n.load(r),n}catch(e){throw s.fatal("No ad due to: "+e),e}}load(e){this.trackingEngine.placementCall(),this.performanceManager.loadStarted(),this.sumoLogManager.sendKPILogIfNeeded(G.placementCall),this.logger.debug("Build AdRequest with assets");const t=this.adRequestBuilder.build(this.pid,e,this.application,this.privacyManager,ie);this.logger.debug("Start AdRequestLoader");const s=this.adRequestLoader.load(t),i=t.nativeAssets.filter(e=>e.isRequired()).map(e=>e.id);this.handleResponse(s,i),this.performanceManager.loadFinished()}handleResponse(e,t){var s,i,r;e instanceof M.AdAvailable?(this.sumoLogManager.sendKPILogIfNeeded(G.adReceived),this.trackingEngine.richAdResponse=e.richAdResponse,(null===(s=e.richAdResponse.ad)||void 0===s?void 0:s.isNative())?this.handleNativeAdFromAdresponse(e,t):((null===(i=e.richAdResponse.ad)||void 0===i?void 0:i.isVastXML())||(null===(r=e.richAdResponse.ad)||void 0===r?void 0:r.isVastURL()))&&(this.sumoLogManager.sendErrorIfNeeded("handleAdFromAdresponse","Non-native ad unsupported"),this.delegate.noAdAvailable(k.richParsingError))):(this.sumoLogManager.sendKPILogIfNeeded(G.adNotAvailable),this.handleAdNotAvailable(e))}handleAdNotAvailable(e){e instanceof M.AdNotAvailable.NetworkError?(this.trackingEngine.adNotAvailableNetworkError(),this.delegate.noAdAvailable(k.networkError)):e instanceof M.AdNotAvailable.NoResponse?(this.trackingEngine.adNotAvailableNetworkTimeout(),this.delegate.noAdAvailable(k.timeout)):e instanceof M.AdNotAvailable.RichParsingError?(this.trackingEngine.adNotAvailableServerError(),this.delegate.noAdAvailable(k.richParsingError)):e instanceof M.AdNotAvailable.StatusCode?(this.trackingEngine.adNotAvailableServerError(),this.delegate.noAdAvailable(k.statusCode)):e instanceof M.AdNotAvailable.NotFilled?(this.trackingEngine.adNotAvailableNotFilled(),this.delegate.noAdAvailable(k.notFilled)):(this.trackingEngine.adNotAvailableServerError(),this.delegate.noAdAvailable(k.serverError))}handleNativeAdFromAdresponse(e,t){var s;try{const i=null===(s=e.richAdResponse.ad)||void 0===s?void 0:s.content;if(null==i)throw"No content escaped in the native ad from the ad response";this.logger.debug("Handle native ad content escaped: "+i);const r=new ve(this.network,this.logger).handleNativeAdParsing(JSON.parse(i),t);this.logger.debug("Total assets from native content: "+r.assets.length),r.assets.forEach(e=>{e&&this.logger.debug(`Asset ${e.id} of type ${e.type} exported to => ${e.toExport()}`)}),this.trackingEngine.nativeAd=r,this.clickEngine=new X(r,this.trackingEngine,this.logger,this.delegate,this.application,this.sumoLogManager),this.delegate.nativeAdAvailable(r),this.trackingEngine.adAvailableSuccess(),this.sumoLogManager.sendKPILogIfNeeded(G.adAvailableSuccess)}catch(e){this.trackingEngine.adAvailableErrorParseContent(),this.sumoLogManager.sendKPILogIfNeeded(G.adAvailableErrorParseFail),this.delegate.noAdAvailable(k.richParsingError)}}visibilityChange(e){this.visibilityManager.visibilityChange(e)}assetVisibilityChange(e,t){this.visibilityManager.assetVisibilityChange(e,t)}click(){var e;null===(e=this.clickEngine)||void 0===e||e.click()}assetClick(e){var t;null===(t=this.clickEngine)||void 0===t||t.assetClick(e)}tooManyRequestAd(){this.sumoLogManager.sendErrorIfNeeded("tooManyRequestAd","Too many request ad"),this.logger.warning("Too many request ad !")}}e.AdCore=fe,Object.defineProperty(e,"__esModule",{value:!0})}));
