!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e=e||self).AdCoreModule={})}(this,(function(e){"use strict";var t,s;function r(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}Array.prototype.first=function(){return this.isNotEmpty()?this[0]:void 0},Array.prototype.last=function(){if(!this.isEmpty())return this[this.length-1]},Array.prototype.isEmpty=function(){return this.length<=0},Array.prototype.isNotEmpty=function(){return!this.isEmpty()},Array.prototype.tail=function(){return this.slice(1)},String.random=function(e,t=!0){const s=t?"0123456789":"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";let r="";for(let t=0;t<e;t++)r+=s.charAt(Math.floor(Math.random()*s.length));return String(r)},String.prototype.isEmpty=function(){return this.length<=0},function(e){e.Get="GET",e.Post="POST",e.Put="PUT",e.Delete="DELETE",e.Head="HEAD"}(t||(t={})),function(e){let t;e.fromJSON=function(e){const t=JSON.parse(e);return{statusCode:t.statusCode,body:t.body,headers:t.headers,error:t.error}},function(e){e.Timeout="TIMEOUT"}(t=e.ErrorType||(e.ErrorType={}))}(s||(s={}));var i=r(function(e,t,s){return e(s={path:t,exports:{},require:function(e,t){return function(){throw new Error("Dynamic requires are not currently supported by @rollup/plugin-commonjs")}(null==t&&s.path)}},s.exports),s.exports}((function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var s=function(){function e(e){var t=this;t._keys=[],t._values=[],t.length=0,e&&e.forEach((function(e,s){t.set(e[0],e[1])}))}return e.prototype.fromJSON=function(t,s){var r=this,i=function(t){return null!==t&&"object"==typeof t&&s?(new e).fromJSON(t,!0):Array.isArray(t)&&s?t.map((function(e){return i(e)})):t};return Object.keys(t).forEach((function(e){t.hasOwnProperty(e)&&r.set(e,i(t[e]))})),r},e.prototype.toJSON=function(){var t={},s=this,r=function(t){return t instanceof e?t.toJSON():Array.isArray(t)?t.map((function(e){return r(e)})):t};return s.keys().forEach((function(e){t[String(e)]=r(s.get(e))})),t},e.prototype.entries=function(){var e=this;return[].slice.call(this.keys().map((function(t){return[t,e.get(t)]})))},e.prototype.keys=function(){return[].slice.call(this._keys)},e.prototype.values=function(){return[].slice.call(this._values)},e.prototype.has=function(e){return this._keys.indexOf(e)>-1},e.prototype.get=function(e){var t=this._keys.indexOf(e);return t>-1?this._values[t]:void 0},e.prototype.deepGet=function(t){if(!t||!t.length)return null;var s=function(t,r){return null==t?null:r.length?s(t instanceof e?t.get(r[0]):t[r[0]],r.slice(1)):t};return s(this.get(t[0]),t.slice(1))},e.prototype.set=function(e,t){var s=this,r=this._keys.indexOf(e);return r>-1?s._values[r]=t:(s._keys.push(e),s._values.push(t),s.length=s._values.length),this},e.prototype.sortedSet=function(e,t,s,r){var i=this,n=this._keys.length,o=s||0,a=void 0!==r?r:n-1;if(0==n)return i._keys.push(e),i._values.push(t),i;if(e==this._keys[o])return this._values.splice(o,0,t),this;if(e==this._keys[a])return this._values.splice(a,0,t),this;if(e>this._keys[a])return this._keys.splice(a+1,0,e),this._values.splice(a+1,0,t),this;if(e<this._keys[o])return this._values.splice(o,0,t),this._keys.splice(o,0,e),this;if(o>=a)return this;var l=o+Math.floor((a-o)/2);return e<this._keys[l]?this.sortedSet(e,t,o,l-1):e>this._keys[l]?this.sortedSet(e,t,l+1,a):this},e.prototype.size=function(){return this.length},e.prototype.clear=function(){var e=this;return e._keys.length=e.length=e._values.length=0,this},e.prototype.delete=function(e){var t=this,s=t._keys.indexOf(e);return s>-1&&(t._keys.splice(s,1),t._values.splice(s,1),t.length=t._keys.length,!0)},e.prototype.forEach=function(e){var t=this;this._keys.forEach((function(s,r){e(t.get(s),s,r)}))},e.prototype.map=function(e){var t=this;return this.keys().map((function(s,r){return e(t.get(s),s,r)}))},e.prototype.filter=function(e){var t=this;return t._keys.slice().forEach((function(s,r){!1===e(t.get(s),s,r)&&t.delete(s)})),this},e.prototype.clone=function(){return new e(this.entries())},e}();t.TSMap=s})));class n{constructor(e){this.userAgent=e}headerFrom(e){return e=e||new i.TSMap,this.userAgent&&e.set("User-Agent",this.userAgent),e}syncHttpCall(e,t,r="",n=new i.TSMap,o){return s.fromJSON(network.syncHttpCall(e,t,r,JSON.stringify(this.headerFrom(n).toJSON()),o))}asyncHttpCall(e,t,s="",r=new i.TSMap,n){network.asyncHttpCall(e,t,s,JSON.stringify(this.headerFrom(r).toJSON()),n)}postSync(e,s,r,i=30){return this.syncHttpCall(t.Post,e,s,r,i)}postAsync(e,s,r,i=30){this.asyncHttpCall(t.Post,e,s,r,i)}getSync(e,s,r=30){return this.syncHttpCall(t.Get,e,"",s,r)}getAsync(e,s,r=30){this.asyncHttpCall(t.Get,e,"",s,r)}}class o{verbose(e){logger.verbose(e)}debug(e){logger.debug(e)}warning(e){logger.warning(e)}error(e){logger.error(e)}fatal(e){logger.fatal(e)}}class a{name(){return application.name()}version(){return application.version()}build(){return application.build()}bundleId(){return application.bundleId()}canOpenUrl(e){return application.canOpenUrl(e)}}class l{os(){return device.os()}osVersion(){return device.osVersion()}screenWidth(){return device.screenWidth()}screenHeight(){return device.screenHeight()}brand(){return device.brand()}device(){return device.device()}country(){return device.country()}language(){return device.language()}batteryLevel(){return device.batteryLevel()}batteryPowerSaving(){return device.batteryPowerSaving()}env(){return device.env()}network(){return device.network()}family(){return device.family()}carrier(){return device.carrier()}}class c{setString(e,t){preferences.set(e,t)}setNumber(e,t){preferences.set(e,t.toString())}setBool(e,t){preferences.set(e,""+(t?"true":"false"))}getString(e){return preferences.get(e)}getNumber(e){const t=preferences.get(e);return Number(t)}getBool(e){const t=preferences.get(e);return"true"==t||"1"==t}}class d{nativeAdAvailable(e){const t=e.toExport(),s=JSON.stringify(t);delegate.nativeAdAvailable(s)}noAdAvailable(e){delegate.noAdAvailable(e)}openBrowser(e){delegate.openBrowser(e)}jsTracker(e){delegate.jsTracker(e)}onAdImpression(){delegate.onAdImpression()}onAdClicked(){delegate.onAdClicked()}static get(){if(delegate)return new d;throw"AdCoreDelegate missing"}}class h{version(){return sdk.version()}mediator(){return sdk.mediator()}isMediated(){return null!==this.mediator()}}const u=e=>e?e.split(".").map(e=>parseInt(e,10)||0):[];class g{constructor(e,t){this.device=e,this.sdk=t}userId(){return user.userId()}systemOptout(){const e=user.systemOptout();return e&&"IOS"===this.device.os().toUpperCase()&&(e=>{const t=u(e);return t.length<=0?0:t[0]})(this.device.osVersion())>=14?"00000000-0000-0000-0000-000000000000"===this.userId():e}}class p{constructor(e,t,s,r,i,n){this.id=e,this.required=t?1:0,this.title=s,this.img=r,this.video=i,this.data=n}isRequired(){return 1==this.required}static title(e,t,s){return new p(e,t,s)}static image(e,t,s){return new p(e,t,void 0,s)}static video(e,t,s){return new p(e,t,void 0,void 0,s)}static data(e,t,s){return new p(e,t,void 0,void 0,void 0,s)}}class v{constructor(e){this.len=e}}class m{constructor(e,t,s,r){this.type=e,this.wmin=t,this.hmin=s,this.mimes=r}}class f{constructor(e,t){this.type=e,this.len=t}}var A,S,E,b,I;!function(e){e[e.Icon=1]="Icon",e[e.Main=3]="Main"}(A||(A={})),function(e){e[e.Sponsored=1]="Sponsored",e[e.Desc=2]="Desc",e[e.Rating=3]="Rating",e[e.Likes=4]="Likes",e[e.Downloads=5]="Downloads",e[e.Price=6]="Price",e[e.SalePrice=7]="SalePrice",e[e.Phone=8]="Phone",e[e.Address=9]="Address",e[e.Desc2=10]="Desc2",e[e.DisplayURL=11]="DisplayURL",e[e.CTAText=12]="CTAText"}(S||(S={}));class P{constructor(e,t){this.event=e,this.methods=t}}!function(e){e[e.Url=1]="Url",e[e.Js=2]="Js"}(E||(E={})),function(e){e[e.FeedArticle=0]="FeedArticle",e[e.AdMob=-1]="AdMob",e[e.MoPub=-2]="MoPub"}(b||(b={})),function(e){e.fromJSON=function(t){switch(t){case 0:return e.FeedArticle;case-1:return e.AdMob;case-2:return e.MoPub;default:throw"Invalid AdCoreRequestTemplate: "+t}}}(b||(b={})),function(e){e[e.Impression=1]="Impression",e[e.ViewableMrc50=2]="ViewableMrc50",e[e.ViewableMrc100=3]="ViewableMrc100",e[e.ViewableVideo50=4]="ViewableVideo50"}(I||(I={})),function(e){e.description=function(t){switch(t){case e.Impression:return"impression";case e.ViewableMrc50:return"viewable-mrc50";case e.ViewableMrc100:return"viewable-mrc100";case e.ViewableVideo50:return"viewable-video50";default:return null}}}(I||(I={}));class k{constructor(e){this.url=k.cleanUnusedUrlMacro(e.url),this.fallbackUrl=e.fallback?k.cleanUnusedUrlMacro(e.fallback):void 0,this.clickTrackers=e.clicktrackers}static cleanUnusedUrlMacro(e){return e.replace(/[$]?\{(.*?)\}/g,"")}}class y{constructor(e,t){this.type=t,this.id=e.id,e.link&&(this.link=new k(e.link))}toExport(){return{id:this.id,type:this.type.toString()}}}!function(e){let t;!function(e){e.Title="title",e.Icon="icon",e.Image="img",e.Description="desc",e.Sponsored="sponso",e.CTA="cta",e.Video="video",e.Price="price",e.Rating="rating",e.AdChoices="adChoice"}(t=e.Type||(e.Type={}))}(y||(y={}));var T,_,R,N,C,O,w,L,M,D,U,V=y.Type;class x{constructor(e,t,s,r,i,n){this.device=e,this.sdk=t,this.user=s,this.preferences=r,this.settings=i,this.logger=n}build(e,t,s,r,i){const n={locale:this.device.language(),country:this.device.country(),windowReferrerUrl:this.settings.publisherSlotUrl&&!this.settings.publisherSlotUrl.isEmpty()?this.settings.publisherSlotUrl:"mobileappid:"+s.bundleId(),userId:this.user.userId(),network:this.device.network(),deviceType:this.device.device(),screenHeight:this.device.screenHeight(),screenWidth:this.device.screenWidth(),deviceFamily:this.device.family(),carrier:this.device.carrier(),osVersion:this.device.osVersion(),os:this.device.os(),appVersion:s.version(),appId:s.bundleId(),browser:"SDK",sdkVersion:this.sdk.version(),env:this.device.env(),gdprIab:r.evaluateGDPR(this.preferences,t.settings),usPrivacy:r.evaluateUSPrivacy(this.preferences,t.settings),tag:e,nativeAssets:this.generateAssetRequestFromTemplate(t.template,i),events:this.generateEventsRequestFromTemplate(t.template)};return null==n.usPrivacy&&delete n.usPrivacy,n}generateEventsRequestFromTemplate(e){switch(e){case b.AdMob:case b.MoPub:case b.FeedArticle:return[new P(I.Impression,[E.Js,E.Url])]}}generateAssetRequestFromTemplate(e,t){switch(e){case b.AdMob:return[this.title(t,!0),this.iconImage(t,!1),this.mainImage(t,!0),this.sponsored(t,!1),this.description(t,!1),this.cta(t,!1),this.price(t,!1),this.rating(t,!1)];case b.MoPub:return[this.title(t,!0),this.iconImage(t,!1),this.mainImage(t,!0),this.description(t,!1),this.cta(t,!1)];case b.FeedArticle:return[this.title(t,!1),this.iconImage(t,!1),this.mainImage(t,!0),this.sponsored(t,!1),this.cta(t,!1)]}}title(e,t){return p.title(e.toId(V.Title),t,new v(50))}iconImage(e,t){return p.image(e.toId(V.Icon),t,new m(A.Icon,48,48,["image/png","image/jpeg","image/jpg"]))}mainImage(e,t){return p.image(e.toId(V.Image),t,new m(A.Main,600,315,["image/png","image/jpeg","image/jpg"]))}sponsored(e,t){return p.data(e.toId(V.Sponsored),t,new f(S.Sponsored,25))}description(e,t){return p.data(e.toId(V.Description),t,new f(S.Desc,140))}cta(e,t){return p.data(e.toId(V.CTA),t,new f(S.CTAText,15))}price(e,t){return p.data(e.toId(V.Price),t,new f(S.Price,10))}rating(e,t){return p.data(e.toId(V.Rating),t,new f(S.Rating,1))}}class B{}function F(e){return Object.keys(e).map(t=>e[t]?["number","string","boolean"].indexOf(typeof e[t])>=0?encodeURIComponent(t)+"="+encodeURIComponent(e[t]):encodeURIComponent(t)+"="+JSON.stringify(e[t]):encodeURIComponent(t)+"=").join("&")}!function(e){e.noResponse="noResponse",e.networkError="networkError",e.richParsingError="richParsingError",e.notFilled="notFilled",e.timeout="timeout",e.statusCode="statusCode",e.serverError="serverError"}(T||(T={})),function(e){let t;e.AdAvailable=class extends e{constructor(e){super(),this.richAdResponse=e}},function(t){t.NoResponse=class extends e{};t.StatusCode=class extends e{};t.NetworkError=class extends e{};t.RichParsingError=class extends e{};t.NotFilled=class extends e{}}(t=e.AdNotAvailable||(e.AdNotAvailable={}))}(B||(B={})),function(e){let t,s,r;e.fromJSON=function(t){return{slider:e.Slider.fromJSON(t.slider),onlyNative:t.onlyNative,soundOver:t.soundOver,friendly:t.friendly,smartPosition:e.SmartPosition.fromJSON(t.smartPosition),launch:t.launch,soundMute:t.soundMute,secure:t.secure,soundStart:e.SoundStart.fromJSON(t.soundStart),videoPause:t.videoPause,videoStart:t.videoStart}},function(e){e.fromJSON=function(e){return null==e?{enable:!1}:{enable:e.enable}}}(t=e.Slider||(e.Slider={})),function(e){e.fromJSON=function(e){return null==e?{top:!1,corner:!1,mustBypassWhitelist:!1}:{top:e.top,corner:e.corner,mustBypassWhitelist:e.mustBypassWhitelist}}}(s=e.SmartPosition||(e.SmartPosition={})),function(e){e.fromJSON=function(e){return{type:e.type}}}(r=e.SoundStart||(e.SoundStart={}))}(_||(_={})),function(e){let t,s;e.fromJSON=function(t){return{soundButton:e.ButtonComponent.fromJSON(t.soundButton),credits:e.Component.fromJSON(t.credits),progressBar:t.progressBar,label:e.Component.fromJSON(t.label),callButton:e.ButtonComponent.fromJSON(t.callButton),brandLogo:e.Component.fromJSON(t.brandLogo)}},function(e){e.fromJSON=function(e){return{display:e.display}}}(t=e.Component||(e.Component={})),function(e){e.fromJSON=function(e){return{countdown:e.countdown,type:e.type}}}(s=e.ButtonComponent||(e.ButtonComponent={}))}(R||(R={})),function(e){let t;e.fromJSON=function(t){return{brandLogoUrl:t.brandLogoUrl,adType:t.adType,placementId:t.placementId,animation:e.Animations.fromJSON(t.brandLogoUrl),threshold:t.threshold,placementFormat:t.placementFormat}},function(e){e.fromJSON=function(e){return{expand:e.expand,collapse:e.collapse}}}(t=e.Animations||(e.Animations={}))}(N||(N={})),function(e){e.fromJSON=function(e){return{components:R.fromJSON(e.components),behaviors:_.fromJSON(e.behaviors),values:N.fromJSON(e.values)}}}(C||(C={}));class G{constructor(e){this.settings=e.settings,this.type=e.type,this.content=e.content,this.connectionId=e.connectionId,this.scenarioId=e.scenarioId,this.adSourceId=e.adSourceId,this.placementId=e.placementId,this.insertionId=e.insertionId,this.dspCampaignId=e.dspCampaignId,this.dspCreativeId=e.dspCreativeId,this.portfolioItemId=e.portfolioItemId}isNative(){return"NativeJson"==this.type}isVastURL(){return"VastUrl"==this.type}isVastXML(){return"VastXml"==this.type}static fromJSON(e){return new G({settings:C.fromJSON(e.settings),type:e.type,content:e.content,connectionId:e.connection_id,scenarioId:e.scenario_id,adSourceId:e.ad_source_id,placementId:e.placement_id,insertionId:e.insertion_id,dspCampaignId:e.dsp_campaign_id,dspCreativeId:e.dsp_creative_id,portfolioItemId:e.portfolio_item_id})}static fromJSONArray(e){return e.map(e=>G.fromJSON(e))}}class J{constructor(e,t){this.ads=e,this.wigoEnabled=t}static fromJSON(e){const t=G.fromJSONArray(e.ads),s=e.wigoEnabled;return new J(t,s)}get ad(){return this.ads.first()}}class j{constructor(e,t){this.network=e,this.logger=t}load(e){const t=this.createUrl(e),s=this.createBodyRequest(e);this.logger.debug("Post the AdRequest");const r=this.network.postSync(t,s);return this.generateAdResponse(r)}generateAdResponse(e){return this.logger.debug("generateAdResponse"),200===e.statusCode&&e.body?this.handleAdResponseSuccess(e):this.handleAdResponseFailure(e)}handleAdResponseSuccess(e){let t;try{this.logger.debug("handleAdResponseSuccess: "+e.body),t=JSON.parse(e.body);const s=J.fromJSON(t);return s.ad?(this.logger.debug("AdAvailable"),new B.AdAvailable(s)):new B.AdNotAvailable.NotFilled}catch(e){return this.logger.debug("handleAdResponseSuccess error: "+e),new B.AdNotAvailable.RichParsingError}}handleAdResponseFailure(e){switch(e.error){case s.ErrorType.Timeout:return new B.AdNotAvailable.NoResponse;default:return e.statusCode&&200!=e.statusCode?new B.AdNotAvailable.StatusCode:new B.AdNotAvailable.NetworkError}}createUrl(e){return`https://r.teads.tv/rich/${e.tag}?responseSerialization=v2`}createBodyRequest(e){return F(e)}}!function(e){e.CONTENTPLAYHEAD="[CONTENTPLAYHEAD]",e.CACHEBUSTING="[CACHEBUSTING]",e.ERRORCODE="[ERRORCODE]",e.ASSETURI="[ASSETURI]",e.MEDIAFILETYPE="[MEDIAFILETYPE]",e.VIEWABILITY="[VIEWABILITY]",e.DEVICEID="[DEVICEID]",e.BUNDLEID="[BUNDLEID]",e.LIMIT_TRACKING="[LIMIT_TRACKING]",e.PAGEID="[pageId]",e.PID="[pid]",e.SLOT_TYPE="[slotType]",e.ENV="[env]",e.PFID="[pfid]",e.IMPRESSIONID="[impressionId]",e.HEADER_BIDDING_PROVIDER="[headerBiddingProvider]",e.GDPR_STATUS="[gdpr_status]",e.GDPR_CONSENT="[gdpr_consent]",e.GDPR_REASON="[gdpr_reason]",e.USERID="[userId]",e.OS="[os]",e.GID="[insertionId]",e.SID="[connectionId]"}(O||(O={}));class q{constructor(e,t,s,r,i,n,o,a,l,c,d,h,u){this.pid=e,this.request=t,this.network=s,this.logger=r,this.user=i,this.device=n,this.application=o,this.delegate=a,this.preferences=l,this.privacyManager=c,this.sumologManager=d,this.formatVersion=h,this.sdkVersion=u.version()}get vid(){return this.user.userId()}url(e){var t,s;return"https://t.teads.tv/track?"+F({action:e,ts:""+Date.now(),pageId:"0",pid:""+this.pid,env:this.device.env(),pfid:"[pfid]",f:"1",vid:this.vid,referer:null===(s=null===(t=this.request)||void 0===t?void 0:t.settings)||void 0===s?void 0:s.publisherSlotUrl})}fillMacro(e){return Object.values(O).forEach(t=>{e=this.replaceMacro(t,e)}),e}replaceMacro(e,t){var s,r,i,n,o,a,l,c;const d=new RegExp(e.replace("[","\\[").replace("]","\\]"),"gi");if(!1===d.test(t))return t;let h="";const u=this.privacyManager.evaluateGDPR(this.preferences,this.request.settings);switch(e){case O.CONTENTPLAYHEAD:case O.HEADER_BIDDING_PROVIDER:case O.ERRORCODE:case O.ASSETURI:case O.MEDIAFILETYPE:h=e;break;case O.SLOT_TYPE:h="native";break;case O.CACHEBUSTING:h=String.random(8);break;case O.VIEWABILITY:h=""+(null===(r=null===(s=this.visibilityManager)||void 0===s?void 0:s.timeline)||void 0===r?void 0:r.last);break;case O.DEVICEID:h=this.device.device();break;case O.BUNDLEID:h=this.application.bundleId();break;case O.LIMIT_TRACKING:h=this.user.systemOptout()?"1":"0";break;case O.PAGEID:h="0";break;case O.PID:h=""+this.pid;break;case O.ENV:h=this.device.env();break;case O.PFID:h=""+(null===(n=null===(i=this.richAdResponse)||void 0===i?void 0:i.ad)||void 0===n?void 0:n.portfolioItemId);break;case O.IMPRESSIONID:h=""+Date.now();break;case O.GDPR_STATUS:h=""+u.status;break;case O.GDPR_CONSENT:h=""+u.consent;break;case O.GDPR_REASON:h=""+u.reason;break;case O.USERID:h=this.user.userId();break;case O.OS:h=this.device.os();break;case O.GID:h=""+(null===(a=null===(o=this.richAdResponse)||void 0===o?void 0:o.ad)||void 0===a?void 0:a.insertionId);break;case O.SID:h=""+(null===(c=null===(l=this.richAdResponse)||void 0===l?void 0:l.ad)||void 0===c?void 0:c.connectionId)}return h&&!h.isEmpty()?(this.logger.debug(`Macro ${e}, will be changed with ${h}`),t.replace(d,h)):t}track(e){e?(e=this.fillMacro(e),e=this.addVersionInfo(e,this.sdkVersion,this.formatVersion),this.network.getAsync(e)):(this.sumologManager.sendErrorIfNeeded("track","Can't track undefined url"),this.logger.error("Can't track undefined url"))}addVersionInfo(e,t,s){return`${e}&${F({sv:t,fv:s})}`}jsTrack(e){this.logger.debug("t:JS: "+e),this.delegate.jsTracker(e)}placementCall(){const e=this.url("placementCall");this.track(e),this.logger.debug("t:placementCall")}adNotAvailableNetworkError(){const e=this.url("adNotAvailable-networkError");this.track(e),this.logger.debug("t:adNotAvailable-networkError")}adNotAvailableNetworkTimeout(){const e=this.url("adNotAvailable-networkTimeout");this.track(e),this.logger.debug("t:adNotAvailable-networkTimeout")}adNotAvailableServerError(){const e=this.url("adNotAvailable-serverError");this.track(e),this.logger.debug("t:adNotAvailable-serverError")}adNotAvailableNotFilled(){const e=this.url("adNotAvailable-notFilled");this.track(e),this.logger.debug("t:adNotAvailable-notFilled")}adAvailableSuccess(){const e=this.url("adAvailable-success");this.track(e),this.logger.debug("t:adAvailable-success")}adAvailableErrorParseContent(){const e=this.url("adAvailable-error-parseContent");this.track(e),this.logger.debug("t:adAvailable-error-parseContent")}adReached(){const e=this.url("adReached");this.track(e),this.logger.debug("t:adReached")}nativeEventTracking(e,t=[]){var s;if(null==this.richAdResponse)throw"Illegal tracking with adResponse not defined";if(!(null===(s=this.richAdResponse.ad)||void 0===s?void 0:s.isNative())||null==this.nativeAd)return;const r=this.nativeAd.eventTrackers.filter(t=>t.event==e);r.filter(e=>e.method==E.Url).forEach(e=>this.track(e.url)),r.filter(e=>e.method==E.Js).filter(e=>e.url).map(e=>`<script src="${e.url}"><\/script>`).concat(t).reverse().filter(e=>e&&e.length>0).forEach(e=>this.jsTrack(e)),this.logger.debug("t:"+I.description(e))}impression(){var e;this.nativeEventTracking(I.Impression,(null===(e=this.nativeAd)||void 0===e?void 0:e.jsTracker)?[this.nativeAd.jsTracker]:[])}viewableMrc50(){this.nativeEventTracking(I.ViewableMrc50)}viewableMrc100(){this.nativeEventTracking(I.ViewableMrc100)}click(e){this.track(e),this.logger.debug("t:click")}visible(e){}}class H extends Array{get timeframe(){const e=this.sort((e,t)=>e[0]-t[0]),t=e.first(),s=e.last();return e.length>2&&t&&s?s[0]-t[0]:0}}class ${constructor(e){this.frames=[],this.onTimelineChange=e}put(e){this.frames.push(e),this.onTimelineChange()}last(e=0){return this.frames[Math.max(0,this.frames.length-1-e)]}get maxPercentage(){return this.frames.map(e=>e[1]).sort((e,t)=>e-t).last()||0}sessionsWithPercentageMoreOrEqualThan(e){const t=[];let s=new H;for(const t of this.frames)t[1]>=e?s.push(t):s.length>0&&(s=new H);return t.push(s),t}}!function(e){e.placementCall="f11",e.adReceived="f30",e.adNotAvailable="f31",e.adAvailableError="f32",e.adAvailableErrorParseFail="f32-1",e.adAvailableSuccess="f33",e.errorBeforeAdReached="f42",e.adReached="f43",e.impression="f44",e.mrc50="f60",e.mrc100="f61",e.mrcVideo50="f62",e.visibileSeconds="f63",e.click="f64"}(w||(w={}));class Y{constructor(e,t,s,r,i,n,o,a,l=!1){this.network=o,this.logger=a,this.testEnv=l,this.errorSampling=.4,this.performanceSampling=.1,this.kpiSampling=.1,this.sumoCollectorUrl="https://l.teads.tv/inapp/adcore-source",this.sessionQueryParam=this.createSessionQueryParams(i,t,s,e,r,n),this.shouldSendErrorLogs=this.canSendLog(this.errorSampling),this.shouldSendPerformanceLogs=this.canSendLog(this.performanceSampling),this.shouldSendKpiLogs=this.canSendLog(this.kpiSampling)}canSendLog(e){const t=Math.random()<=e;return this.logger.debug(t?"SumoManager will send logs":"SumoManager won't send logs"),t}createSessionQueryParams(e,t,s,r,i,n){return`pid=${e}&app=${t.name()}&bundle=${t.bundleId()}&appv=${t.version()}&adcV=${n}&sdk=${s.version()}&osv=${r.osVersion()}&os=${r.os()}&opt=${i.systemOptout()}&med=${s.mediator()}`}sendErrorIfNeeded(e,t){if(this.shouldSendErrorLogs){const s=this.createError(e,t,this.errorSampling);this.sendSumoLog(s)}}sendPerformanceLogIfNeeded(e,t){if(this.shouldSendPerformanceLogs){const s=this.createPerformanceLog(e,t,this.performanceSampling);this.sendSumoLog(s)}}sendKPILogIfNeeded(e){if(this.shouldSendKpiLogs){const t=this.createKPILog(e,this.kpiSampling);this.sendSumoLog(t)}}sendSumoLog(e){this.testEnv||this.network.postAsync(this.sumoCollectorUrl,this.appendSumoLogToSession(e))}appendSumoLogToSession(e){return this.sessionQueryParam+"&"+e}createKPILog(e,t){return`event=${e}&samp=${t}`}createError(e,t,s){return`method=${e}&info=${t}&event=error&samp=${s}`}createPerformanceLog(e,t,s){return`event=${e}&tm=${t}&samp=${s}`}}class K{constructor(e,t,s,r){this.sumoLogger=r,this.impressionReached=!1,this.adReached=!1,this.viewableMrc50Reached=!1,this.viewableMrc100Reached=!1,this.intervalsReached=new Set,this.intervalsToCheck=[1,2,3,4,5,6,7,8,9],this.trackingEngine=e,this.delegate=t,this.logger=s,this.timeline=new $(()=>this.onTimelineChange()),this.assetTimeline=new Map,this.trackingEngine.visibilityManager=this}onTimelineChange(){void 0!==this.timeline.last(1)&&this.timeline.last()[1]==this.timeline.last(1)[1]||this.logger.debug(`v:ad ${this.timeline.last()[1]}%`),this.checkForAdReach(),this.checkForImpression(),this.checkForViewableMrc50(),this.checkForViewableMrc100(),this.intervalsToCheck.forEach(e=>{this.checkForVisibleAtInterval(e)})}checkForAdReach(){this.adReached||this.timeline.maxPercentage>0&&(this.adReached=!0,this.trackingEngine.adReached(),this.sumoLogger.sendKPILogIfNeeded(w.adReached))}checkForVisibleAtInterval(e){if(!this.intervalsReached.has(e)&&this.timeline.maxPercentage>0){this.timeline.sessionsWithPercentageMoreOrEqualThan(1).filter(t=>t.timeframe>=1e3*e).length>0&&(this.intervalsReached.add(e),this.trackingEngine.visible(e),this.sumoLogger.sendKPILogIfNeeded(w.visibileSeconds+"-"+e))}}checkForImpression(){this.impressionReached||this.timeline.maxPercentage>50&&(this.impressionReached=!0,this.delegate.onAdImpression(),this.trackingEngine.impression(),this.sumoLogger.sendKPILogIfNeeded(w.impression))}checkForViewableMrc50(){if(!this.viewableMrc50Reached&&this.timeline.maxPercentage>=50){this.timeline.sessionsWithPercentageMoreOrEqualThan(50).filter(e=>e.timeframe>=1e3).length>0&&(this.viewableMrc50Reached=!0,this.trackingEngine.viewableMrc50(),this.sumoLogger.sendKPILogIfNeeded(w.mrc50))}}checkForViewableMrc100(){if(!this.viewableMrc100Reached&&this.timeline.maxPercentage>=100){this.timeline.sessionsWithPercentageMoreOrEqualThan(100).filter(e=>e.timeframe>=1e3).length>0&&(this.viewableMrc100Reached=!0,this.trackingEngine.viewableMrc100(),this.sumoLogger.sendKPILogIfNeeded(w.mrc100))}}visibilityChange(e){this.timeline.put([Date.now(),e])}assetVisibilityChange(e,t){}}function W({gdprStatus:e,gdprConsent:t,gdprApiVersion:s,gdprCmpId:r}){const i={apiVersion:null,cmpId:r||null};if(null!=e&&t){if(e){return(t&&t.length>0?t:null)&&(i.apiVersion=s||D.V1),Object.assign({status:L.GDPR_APPLIES_PUBLISHER,consent:t&&t.length>0?t:null,reason:M.GDPR_APPLIES_PUBLISHER_CLASSIC},i)}return Object.assign({status:L.GDPR_DOESNT_APPLY,consent:null,reason:M.GDPR_DOESNT_APPLY},i)}return Object.assign({status:L.UNSUCCESSFUL_CMP_RESPONSE,consent:null,reason:M.UNSUCCESSFUL_CMP_RESPONSE},i)}!function(e){e[e.GDPR_DOESNT_APPLY=0]="GDPR_DOESNT_APPLY",e[e.GDPR_APPLIES_GLOBAL=11]="GDPR_APPLIES_GLOBAL",e[e.GDPR_APPLIES_PUBLISHER=12]="GDPR_APPLIES_PUBLISHER",e[e.UNSUCCESSFUL_CMP_RESPONSE=21]="UNSUCCESSFUL_CMP_RESPONSE",e[e.CMP_NOT_FOUND=22]="CMP_NOT_FOUND",e[e.CMP_NOT_READY=23]="CMP_NOT_READY",e[e.OTHER=24]="OTHER"}(L||(L={})),function(e){e[e.GDPR_DOESNT_APPLY=0]="GDPR_DOESNT_APPLY",e[e.GDPR_APPLIES_GLOBAL_CLASSIC=110]="GDPR_APPLIES_GLOBAL_CLASSIC",e[e.GDPR_APPLIES_GLOBAL_OVERLAY=111]="GDPR_APPLIES_GLOBAL_OVERLAY",e[e.GDPR_APPLIES_GLOBAL_TEADS_BECAUSE_NO_CMP=112]="GDPR_APPLIES_GLOBAL_TEADS_BECAUSE_NO_CMP",e[e.GDPR_APPLIES_GLOBAL_TEADS_AFTER_TIMEOUT=113]="GDPR_APPLIES_GLOBAL_TEADS_AFTER_TIMEOUT",e[e.GDPR_APPLIES_GLOBAL_TEADS_AFTER_CMP_ERROR=114]="GDPR_APPLIES_GLOBAL_TEADS_AFTER_CMP_ERROR",e[e.GDPR_APPLIES_PUBLISHER_CLASSIC=120]="GDPR_APPLIES_PUBLISHER_CLASSIC",e[e.GDPR_APPLIES_PUBLISHER_OVERLAY=121]="GDPR_APPLIES_PUBLISHER_OVERLAY",e[e.GDPR_APPLIES_PUBLISHER_TEADS_BECAUSE_NO_CMP=122]="GDPR_APPLIES_PUBLISHER_TEADS_BECAUSE_NO_CMP",e[e.GDPR_APPLIES_PUBLISHER_TEADS_AFTER_TIMEOUT=123]="GDPR_APPLIES_PUBLISHER_TEADS_AFTER_TIMEOUT",e[e.GDPR_APPLIES_PUBLISHER_TEADS_AFTER_CMP_ERROR=124]="GDPR_APPLIES_PUBLISHER_TEADS_AFTER_CMP_ERROR",e[e.UNSUCCESSFUL_CMP_RESPONSE=210]="UNSUCCESSFUL_CMP_RESPONSE",e[e.CMP_ERROR=211]="CMP_ERROR",e[e.CMP_NOT_FOUND=220]="CMP_NOT_FOUND",e[e.CMP_NOT_READY_NO_RESPONSE=230]="CMP_NOT_READY_NO_RESPONSE",e[e.CMP_NOT_READY_JS_NOT_LOADED=231]="CMP_NOT_READY_JS_NOT_LOADED",e[e.CMP_NOT_READY_NO_PING_RESPONSE=232]="CMP_NOT_READY_NO_PING_RESPONSE",e[e.OTHER=240]="OTHER"}(M||(M={})),function(e){e[e.V1=1]="V1",e[e.V2=2]="V2"}(D||(D={})),function(e){e.getVendorConsents="getVendorConsents",e.getConsentData="getConsentData",e.ping="ping",e.getPublisherConsents="getPublisherConsents",e.getVendorList="getVendorList"}(U||(U={}));class Q{evaluateGDPR(e,t){const s=e.getBool("IABConsent_SubjectToGDPR"),r=e.getString("IABConsent_ConsentString"),i=e.getNumber("IABTCF_gdprApplies"),n=e.getString("IABTCF_TCString"),o=e.getNumber("IABTCF_PolicyVersion"),a=e.getNumber("IABTCF_CmpSdkID");if((null==t?void 0:t.consent)&&(null==t?void 0:t.subjectToGDPR)){return W({gdprStatus:"1"===(null==t?void 0:t.subjectToGDPR),gdprConsent:null==t?void 0:t.consent,gdprApiVersion:null==t?void 0:t.tcfVersion,gdprCmpId:null==t?void 0:t.cmpSdkID})}if(i&&n&&o&&a){return W({gdprStatus:1===i,gdprConsent:n,gdprApiVersion:2===o?D.V2:D.V1,gdprCmpId:a})}return W({gdprStatus:s,gdprConsent:r,gdprApiVersion:D.V1})}evaluateUSPrivacy(e,t){const s=e.getString("IABUSPrivacy_String");return(null==t?void 0:t.usPrivacy)||s?(null==t?void 0:t.usPrivacy)||s:null}}class X extends y{constructor(e){super(e,y.Type.AdChoices),this.fallbackUrl="https://privacy-policy.teads.tv?utm_source=inread&utm_medium=icon&utm_campaign=adchoices"}toExport(){return Object.assign(Object.assign({},super.toExport()),{fallbackUrl:this.fallbackUrl})}}class z{constructor(e,t,s,r,i,n){this.nativeAd=e,this.trackingEngine=t,this.logger=s,this.delegate=r,this.application=i,this.sumoLogger=n}click(){this.handleClick(this.nativeAd.link)}assetClick(e){const t=this.nativeAd.assetWithId(e);t?(this.logger.debug("click on asset "+e),this.handleClick(t.link,e)):this.logger.warning("Asset click on unknown asset with id "+e)}handleClick(e,t){this.sumoLogger.sendKPILogIfNeeded(w.click),e?this.handleClickIfPossible(e,t):this.handleClickIfPossible(this.nativeAd.link,t)}handleClickIfPossible(e,t){if(e)if(e.clickTrackers&&e.clickTrackers.forEach(e=>{this.trackingEngine.click(e)}),(!t||t&&100!=t)&&this.delegate.onAdClicked(),e.url&&this.application.canOpenUrl(e.url))this.logger.debug("Open Browser on url "+e.url),this.delegate.openBrowser(e.url);else if(e.fallbackUrl&&this.application.canOpenUrl(e.fallbackUrl)){if(this.logger.debug(`Click using fallback url (original is ${e.url})`),this.delegate.openBrowser(e.fallbackUrl),e.url){const t=`Can't open original url (${e.url})`;this.sumoLogger.sendErrorIfNeeded("handleClickIfPossible",t),this.logger.error(t)}}else{const t=`Can't open fallbackUrl url (${e.fallbackUrl})`;this.sumoLogger.sendErrorIfNeeded("handleClickIfPossible",t),this.logger.error(t)}}}var Z;!function(e){e.timeToInit="tm0",e.timeToLoad="tm1"}(Z||(Z={}));class ee{constructor(e,t){this.sumologManager=e,this.initTS=t}finishInit(){this.finishInitTS=Date.now(),this.sumologManager.sendPerformanceLogIfNeeded(Z.timeToInit,this.calculateTimeDifferenceInMS(this.initTS,this.finishInitTS))}loadStarted(){this.loadStartedTS=Date.now()}loadFinished(){if(null==this.loadStartedTS)throw"Illegal state, cannot call loadFinish if not started before";this.loadFinishedTS=Date.now(),this.sumologManager.sendPerformanceLogIfNeeded(Z.timeToLoad,this.calculateTimeDifferenceInMS(this.loadStartedTS,this.loadFinishedTS))}calculateTimeDifferenceInMS(e,t){return Math.abs(e-t)}}var te,se,re;!function(e){e[e.SLOW=1]="SLOW",e[e.NORMAL=2]="NORMAL",e[e.FAST=3]="FAST"}(te||(te={})),function(e){e.fromJSON=function(e){return{debugModeEnabled:e.debugModeEnabled,locationEnabled:e.locationEnabled,lightEndScreenEnabled:e.lightEndScreenEnabled,mediaPreloadEnabled:e.mediaPreloadEnabled,publisherSlotUrl:e.publisherSlotUrl,consent:e.consent,subjectToGDPR:e.subjectToGDPR,tcfVersion:2===e.tcfVersion?D.V2:D.V1,cmpSdkID:e.cmpSdkID,validationModeEnabled:e.validationModeEnabled,usPrivacy:e.usPrivacy,extras:(new i.TSMap).fromJSON(e.extras||{}),crashReporterEnabled:e.crashReporterEnabled,audioSessionIsApplicationManaged:e.audioSessionIsApplicationManaged,batteryMonitoringEnabled:e.batteryMonitoringEnabled,browserUrlHidden:e.browserUrlHidden,browserToolbarBackgroundColor:e.browserToolbarBackgroundColor,visibilityCheckSpeed:e.visibilityCheckSpeed}}}(se||(se={})),function(e){e.fromJSON=function(e){return{settings:se.fromJSON(e.settings),template:b.fromJSON(e.template)}}}(re||(re={}));const ie=new class{constructor(e){this.assetTypeToId=new Map,this.idToAssetType=new Map;for(const[t,s]of e){if(this.assetTypeToId.has(s))throw"Illegal mapping: duplicate assetType "+s;if(this.idToAssetType.has(t))throw"Illegal mapping: duplicate id "+t;this.assetTypeToId.set(s,t),this.idToAssetType.set(t,s)}}toId(e){const t=this.assetTypeToId.get(e);if(null==t)throw"Broken mapping for asset type: "+e;return t}toAssetType(e){return this.idToAssetType.get(e)||null}}([[0,y.Type.Title],[1,y.Type.Icon],[2,y.Type.Image],[3,y.Type.Sponsored],[4,y.Type.Description],[5,y.Type.CTA],[6,y.Type.Video],[7,y.Type.Price],[8,y.Type.Rating],[100,y.Type.AdChoices]]);class ne{constructor(e,t,s){this.event=e,this.method=t,this.url=s}static fromJSON(e){return new ne(e.event,e.method,e.url)}}class oe extends y{constructor(e){super(e,y.Type.CTA);const t=e.data||{};this.text=t.value}toExport(){return Object.assign(Object.assign({},super.toExport()),{text:this.text})}}class ae extends y{constructor(e){super(e,y.Type.Title);const t=e.title||{};this.text=t.text}toExport(){return Object.assign(Object.assign({},super.toExport()),{text:this.text})}}class le extends y{constructor(e){super(e,y.Type.Image);const t=e.img||{};this.url=t.url,this.width=t.width,this.height=t.height}toExport(){return Object.assign(Object.assign({},super.toExport()),{url:this.url})}}class ce extends y{constructor(e){super(e,y.Type.Description);const t=e.data||{};this.text=t.value}toExport(){return Object.assign(Object.assign({},super.toExport()),{text:this.text})}}class de extends y{constructor(e){super(e,y.Type.Icon);const t=e.img||{};this.url=t.url,this.width=t.width,this.height=t.height}toExport(){return Object.assign(Object.assign({},super.toExport()),{url:this.url})}}class he extends y{constructor(e){super(e,y.Type.Sponsored);const t=e.data||{};this.text=t.value}toExport(){return Object.assign(Object.assign({},super.toExport()),{text:this.text})}}class ue extends y{constructor(e){super(e,y.Type.Rating);const t=e.data||{};this.text=t.value}toExport(){return Object.assign(Object.assign({},super.toExport()),{text:this.text})}}class ge extends y{constructor(e){super(e,y.Type.Price);const t=e.data||{};this.text=t.value}toExport(){return Object.assign(Object.assign({},super.toExport()),{text:this.text})}}class pe{constructor({version:e,link:t,eventTrackers:s,jsTracker:r,assets:i,assetsUrl:n}){this.version=e,this.link=t,this.eventTrackers=s,this.jsTracker=r,this.assets=i,this.assetsUrl=n}assetWithId(e){return this.assets.find(t=>t.id==e)}static fromJSON(e,t){if(!e.native)throw"Ad response doesnt contain native";const s=e.native,r=(s.eventtrackers||[]).map(e=>ne.fromJSON(e)),i=new k(s.link),n=pe.parseAssets(s,t)||[],o=s.assetsurl;return new pe({version:s.ver,link:i,jsTracker:s.jstracker,eventTrackers:r,assets:n,assetsUrl:o})}adChoicesAsset(){return this.assets.filter((e,t,s)=>100==e.id).first()}validateAssets(e){const t=this.assets.map(e=>e.id);return e.every(e=>t.includes(e))}static parseAssets(e,t){var s;return null===(s=e.assets)||void 0===s?void 0:s.map(e=>{const s=e.id;if(null==s)return null;switch(t.toAssetType(s)){case y.Type.CTA:return new oe(e);case y.Type.Icon:return new de(e);case y.Type.Description:return new ce(e);case y.Type.Image:return new le(e);case y.Type.Sponsored:return new he(e);case y.Type.Title:return new ae(e);case y.Type.Price:return new ge(e);case y.Type.Rating:return new ue(e);case y.Type.AdChoices:return new X(e);case y.Type.Video:default:return null}})}toExport(){return this.assets.map(e=>e.toExport())}}class ve{constructor({link:e,eventTrackers:t,assets:s}){this.link=e,this.eventTrackers=t,this.assets=s}static fromJSON(e,t){const s=pe.parseAssets(e,t),r=(e.eventtrackers||[]).map(e=>ne.fromJSON(e));return new ve({link:new k(e.link),eventTrackers:r,assets:s})}}class me{constructor(e,t,s){this.network=e,this.logger=t,this.assetTypeMapping=s}load(e){const t=this.network.getSync(e);return this.generateAssetsUrlResponse(t)}generateAssetsUrlResponse(e){if(200===e.statusCode&&e.body)return this.handleAssetsUrlResponseSuccess(e)}handleAssetsUrlResponseSuccess(e){try{const t=JSON.parse(e.body),s=ve.fromJSON(t,this.assetTypeMapping);return this.logger.debug("AssetsUrlContent available"),s}catch(e){return void this.logger.warning("Unable to parse assetsUrl response")}}}class fe{constructor(e,t){this.network=e,this.logger=t}handleNativeAdParsing(e,t){const s=pe.fromJSON(e,ie),r=this.fetchAssetsUrl(ie,s.assetsUrl),i=fe.merge(s,r);if(!i.validateAssets(t))throw`NativeAd doesnt contain requested required assets (${t.join(",")})`;return i}fetchAssetsUrl(e,t){if(null!=t){return new me(this.network,this.logger,e).load(t)}}static merge(e,t){if(null!=t){const s=t.assets,r=e.adChoicesAsset();null!=r&&s.push(r);const i=e.eventTrackers.concat(t.eventTrackers),n=e.link.clickTrackers.concat(t.link.clickTrackers),o=new k({url:t.link.url,fallback:t.link.fallbackUrl,clicktrackers:n});return new pe({version:e.version,link:o,jsTracker:e.jsTracker,eventTrackers:i,assets:s,assetsUrl:e.assetsUrl})}return e}}class Ae{constructor(e,t,s,r){this.logger=s,this.application=new a,this.device=new l,this.network=new n(function(e,t){if("Apple"==e.brand()){const s="tablet"==e.family()?"iPad":"iPhone",r=e.osVersion().split(".").join("_");return`${t.name()}/${t.version()} (${s}; CPU iPhone OS ${r} like Mac OS X) AppleWebKit (KHTML, like Gecko) Mobile`}}(this.device,this.application)),this.logger=s,this.delegate=d.get(),this.preferences=new c,this.sdk=new h,this.user=new g(this.device,this.sdk),this.privacyManager=new Q,this.pid=e;let i="adc-52";"".isEmpty()||(i+="-"),this.sumoLogManager=new Y(this.device,this.application,this.sdk,this.user,this.pid,i,this.network,s),this.performanceManager=new ee(this.sumoLogManager,r),this.logger.debug("Create AdCore with PID "+this.pid),this.adCoreRequest=t,this.logger.debug("Native template requested : "+this.adCoreRequest.template),this.logger.debug("Create Tracking Engine"),this.trackingEngine=new q(this.pid,this.adCoreRequest,this.network,this.logger,this.user,this.device,this.application,this.delegate,this.preferences,this.privacyManager,this.sumoLogManager,i,this.sdk),this.logger.debug("Create AdRequestBuilder"),this.adRequestBuilder=new x(this.device,this.sdk,this.user,this.preferences,this.adCoreRequest.settings,this.logger),this.logger.debug("Create AdRequestLoader"),this.adRequestLoader=new j(this.network,this.logger),this.logger.debug("Create VisibilityManager"),this.visibilityManager=new K(this.trackingEngine,this.delegate,this.logger,this.sumoLogManager),this.performanceManager.finishInit()}static adCoreRequestFromJson(e,t){try{const s=JSON.parse(e);return t.debug(""+JSON.stringify(s)),re.fromJSON(s)}catch(e){if(e instanceof SyntaxError)throw"Ad request malformed and unrecoverable";throw e}}static loadFromRequest(e,t){const s=new o;try{const r=Date.now(),i=Ae.adCoreRequestFromJson(t,s),n=new Ae(e,i,s,r);return n.load(i),n}catch(e){throw s.fatal("No ad due to: "+e),e}}load(e){this.trackingEngine.placementCall(),this.performanceManager.loadStarted(),this.sumoLogManager.sendKPILogIfNeeded(w.placementCall),this.logger.debug("Build AdRequest with assets");const t=this.adRequestBuilder.build(this.pid,e,this.application,this.privacyManager,ie);this.logger.debug("Start AdRequestLoader");const s=this.adRequestLoader.load(t),r=t.nativeAssets.filter(e=>e.isRequired()).map(e=>e.id);this.handleResponse(s,r),this.performanceManager.loadFinished()}handleResponse(e,t){var s,r,i;e instanceof B.AdAvailable?(this.sumoLogManager.sendKPILogIfNeeded(w.adReceived),this.trackingEngine.richAdResponse=e.richAdResponse,(null===(s=e.richAdResponse.ad)||void 0===s?void 0:s.isNative())?this.handleNativeAdFromAdresponse(e,t):((null===(r=e.richAdResponse.ad)||void 0===r?void 0:r.isVastXML())||(null===(i=e.richAdResponse.ad)||void 0===i?void 0:i.isVastURL()))&&(this.sumoLogManager.sendErrorIfNeeded("handleAdFromAdresponse","Non-native ad unsupported"),this.delegate.noAdAvailable(T.richParsingError))):(this.sumoLogManager.sendKPILogIfNeeded(w.adNotAvailable),this.handleAdNotAvailable(e))}handleAdNotAvailable(e){e instanceof B.AdNotAvailable.NetworkError?(this.trackingEngine.adNotAvailableNetworkError(),this.delegate.noAdAvailable(T.networkError)):e instanceof B.AdNotAvailable.NoResponse?(this.trackingEngine.adNotAvailableNetworkTimeout(),this.delegate.noAdAvailable(T.timeout)):e instanceof B.AdNotAvailable.RichParsingError?(this.trackingEngine.adNotAvailableServerError(),this.delegate.noAdAvailable(T.richParsingError)):e instanceof B.AdNotAvailable.StatusCode?(this.trackingEngine.adNotAvailableServerError(),this.delegate.noAdAvailable(T.statusCode)):e instanceof B.AdNotAvailable.NotFilled?(this.trackingEngine.adNotAvailableNotFilled(),this.delegate.noAdAvailable(T.notFilled)):(this.trackingEngine.adNotAvailableServerError(),this.delegate.noAdAvailable(T.serverError))}handleNativeAdFromAdresponse(e,t){var s;try{const r=null===(s=e.richAdResponse.ad)||void 0===s?void 0:s.content;if(null==r)throw"No content escaped in the native ad from the ad response";this.logger.debug("Handle native ad content escaped: "+r);const i=new fe(this.network,this.logger).handleNativeAdParsing(JSON.parse(r),t);this.logger.debug("Total assets from native content: "+i.assets.length),i.assets.forEach(e=>{e&&this.logger.debug(`Asset ${e.id} of type ${e.type} exported to => ${e.toExport()}`)}),this.trackingEngine.nativeAd=i,this.clickEngine=new z(i,this.trackingEngine,this.logger,this.delegate,this.application,this.sumoLogManager),this.delegate.nativeAdAvailable(i),this.trackingEngine.adAvailableSuccess(),this.sumoLogManager.sendKPILogIfNeeded(w.adAvailableSuccess)}catch(e){this.trackingEngine.adAvailableErrorParseContent(),this.sumoLogManager.sendKPILogIfNeeded(w.adAvailableErrorParseFail),this.delegate.noAdAvailable(T.richParsingError)}}visibilityChange(e){this.visibilityManager.visibilityChange(e)}assetVisibilityChange(e,t){this.visibilityManager.assetVisibilityChange(e,t)}click(){var e;null===(e=this.clickEngine)||void 0===e||e.click()}assetClick(e){var t;null===(t=this.clickEngine)||void 0===t||t.assetClick(e)}tooManyRequestAd(){this.sumoLogManager.sendErrorIfNeeded("tooManyRequestAd","Too many request ad"),this.logger.warning("Too many request ad !")}}e.AdCore=Ae,Object.defineProperty(e,"__esModule",{value:!0})}));
